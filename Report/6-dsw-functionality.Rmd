# DSW water points


```{r}
dsw <-
  wp_census %>%
  dplyr::filter(intervention_type == "DSW")
```

## By sample group

```{r}
evac <-
  villages %>%
  select(country, sample_group, village_id, dsw_wpt) %>%
  dplyr::filter(village_id %in% dsw$village_id) %>%
  group_by(country, sample_group) %>%
  summarise(
    dsw_wpt = sum(dsw_wpt)
  )

dsw_func <-
  dsw %>%
  group_by(country, sample_group) %>%
  summarise(
    Villages = n_distinct(village_id),
    `WP census` = n_distinct(wp_id),
    `Matched to EvAc data` = sum(!is.na(ea_id)),
    `WP functional` = sum(wp_func, na.rm = TRUE),
    `Casing present` = sum(disp_casing_present, na.rm = TRUE),
    `Tank present` = sum(disp_tank_present, na.rm = TRUE),
    `Dispenser functional` = sum(disp_func, na.rm = TRUE),
    `Dispenser filled` = sum(disp_filled, na.rm = TRUE)
  ) %>%
  mutate(
    across(
      `Matched to EvAc data`:`Dispenser filled`,
      ~ round(. * 100/`WP census`, 1)
    )
  ) %>%
  ungroup %>%
  left_join(evac) %>%
  select(-country) %>%
  select(Sample = sample_group, Villages, `EvAc data` = dsw_wpt, everything())

dsw_func %>%
  kable(
    format = "html"
  ) %>%
  pack_rows("Malawi", 1, 3) %>%
  pack_rows("Uganda", 4, 5) %>%
  kable_paper("striped", full_width = TRUE) %>%
  add_header_above(
    c(
      " " = 2,
      "Number of WPs" = 2,
      "Percent of water points in the census" = 6
    ),
    line = TRUE
  ) %>%
  add_header_above(
    c(" ", paste0("(", 1:9,")")), 
    line = FALSE
  )
```

```{r}
kable(
  dsw_func,
  format = "latex",
  escape = F,
  align = "c", 
  booktabs = T,
  caption = "Functionality rate",
  label = "dsw-func-group"
) %>%
  kable_styling(latex_options = c("scale_down", "HOLD_position")) %>%
  pack_rows("Malawi", 1, 3) %>%
  pack_rows("Uganda", 4, 5) %>%
  add_header_above(
    c(
      " " = 2,
      "Number of WPs" = 2,
      "Percent of water points in the census" = 6
    ),
    line = TRUE
  ) %>%
  add_header_above(
    c(" ", paste0("(", 1:9,")")), 
    line = FALSE
  ) %>%
  column_spec(c(1, 2, 7, 8, 10), width = "1.5cm") %>%
  column_spec(3:4, width = "1cm") %>%
  column_spec(c(5, 8), width = "2cm") %>%
  writeLines(
    "output/appendix-tables/dsw-func-group.tex"
  )
```

## By country

```{r}
evac <-
  villages %>%
  select(country, village_id, dsw_wpt) %>%
  dplyr::filter(village_id %in% dsw$village_id) %>%
  group_by(country) %>%
  summarise(
    dsw_wpt = sum(dsw_wpt)
  )

dsw_func <-
  dsw %>%
  group_by(country) %>%
  summarise(
    Villages = n_distinct(village_id),
    `WP census` = n_distinct(wp_id),
    `Matched to EvAc data` = sum(!is.na(ea_id)),
    `WP functional` = sum(wp_func, na.rm = TRUE),
    `Casing present` = sum(disp_casing_present, na.rm = TRUE),
    `Tank present` = sum(disp_tank_present, na.rm = TRUE),
    `Dispenser functional` = sum(disp_func, na.rm = TRUE),
    `Dispenser filled` = sum(disp_filled, na.rm = TRUE)
  ) %>%
  mutate(
    across(
      `Matched to EvAc data`:`Dispenser filled`,
      ~ round(. * 100/`WP census`, 1)
    )
  ) %>%
  left_join(evac) %>%
  select(Country = country, Villages, `EvAc data` = dsw_wpt, everything())

dsw_func %>%
  kable(
    format = "html"
  ) %>%
  kable_paper("striped", full_width = TRUE) %>%
  add_header_above(
    c(
      " " = 2,
      "Number of WPs" = 2,
      "Percent of water points in the census" = 6
    ),
    line = TRUE
  ) %>%
  add_header_above(
    c(" ", paste0("(", 1:9,")")), 
    line = FALSE
  )
```

```{r}
kable(
  dsw_func, 
  format = "latex",
  escape = F,
  align = "c", 
  booktabs = T,
  caption = "Functionality rate",
  label = "dsw-func"
) %>%
  kable_styling(latex_options = c("scale_down", "HOLD_position")) %>%
  add_header_above(
    c(
      " " = 2,
      "Number of WPs" = 2,
      "Percent of water points in the census" = 6
    ),
    line = TRUE
  ) %>%
  add_header_above(
    c(" ", paste0("(", 1:9,")")), 
    line = FALSE
  ) %>%
  column_spec(c(1, 2, 7, 8, 10), width = "1.5cm") %>%
  column_spec(3:4, width = "1cm") %>%
  column_spec(c(5, 8), width = "2cm") %>%
  writeLines(
    "output/tables/dsw-func.tex"
  )
```

## Text

### Functionality rates among non-program WPs

```{r}
wp_census %>%
  dplyr::filter(intervention == "Non-program") %>%
  group_by(country) %>%
  summarise(mean(wp_func, na.rm = TRUE))
```


