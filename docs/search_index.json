[["index.html", "Chlorine adoption survey 1 Disclaimer", " Chlorine adoption survey Development Innovation Lab 2025-08-21 1 Disclaimer This document shows exploratory analysis results for the chlorine adoption surveys conducted in Malawi and Uganda. It is a work in progress meant to keep all the partners in the loop of how analysis is advancing. The numbers shown in this document will change as we collect more data and address issues identified in the field. The DIL team is double-coding the analysis numbers, and we have not yet validated the estimates in this document. "],["annecdotes-from-the-field-incomplete.html", "2 Annecdotes from the field (Incomplete)", " 2 Annecdotes from the field (Incomplete) In some villages where most of the taps were water collection points, the field team classified all taps as ILC. We are still confirming whether these are correct classifications or not. In Uganda, the field teams only received the second batch of colorimeters at the very end on data collection. This will reduce our power for colorimeter take-up estimates. We observed that in Malawi, it is rare for households to collect water with a jerrican. They typically use a bucket, which means the chlorine evaporates faster and there is more risk of recontamination. To do: check water storage in the household In some villages, the promoters filled the dispenser after they saw the FOs inspecting it Three villages in Uganda were replaced after the field team realized that the chairperson and the promoter were expecting the data collection. In one village in Uganda, the promoter distributed water to be tested if asked by IPA. Two villages in Uganda was replaced because no dispensers were found. In one of these cases, the dispenser was located in a neighboring village, that was used as replacement "],["sample-sizes.html", "3 Sample sizes 3.1 Water points 3.2 Household survey 3.3 Monitoring survey 3.4 Chlorine tests 3.5 Potential contamination", " 3 Sample sizes Code packages &lt;- c( &quot;stringr&quot;, &quot;sf&quot;, &quot;tidyverse&quot;, &quot;viridis&quot;, &quot;janitor&quot; ) pacman::p_load( packages, character.only = TRUE ) 3.1 Water points Code wp &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;WaterPointCensus&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;wp-census.rds&quot; ) ) wp %&gt;% group_by(country) %&gt;% summarise( Villages = n_distinct(village_id), `Water points` = n_distinct(wp_id), ILC = sum(str_detect(intervention_type, &quot;ILC&quot;), na.rm = TRUE), DSW = sum(intervention_type == &quot;DSW&quot;, na.rm = TRUE), `Color wheel FCR test` = sum(!is.na(discfcr)), `Color wheel TCR test` = sum(!is.na(disctcr)), `Colorimeter FCR test` = sum(!is.na(meterfcr)), `Colorimeter TCR test` = sum(!is.na(metertcr)), ) %&gt;% pivot_longer(cols = -country) %&gt;% pivot_wider( names_from = country, values_from = value ) %&gt;% kable( caption = &quot;Average share of households that has at least 0.2 ppm of TCR on color wheel&quot;, col.names = c(&quot;Sample&quot;, &quot;Malawi&quot;, &quot;Uganda&quot;), align = c(&quot;l&quot;, &quot;c&quot;, &quot;c&quot;) ) %&gt;% kable_styling( full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;) ) Table 3.1: Table 3.2: Average share of households that has at least 0.2 ppm of TCR on color wheel Sample Malawi Uganda Villages 103 62 Water points 658 541 ILC 177 4 DSW 197 188 Color wheel FCR test 173 142 Color wheel TCR test 173 142 Colorimeter FCR test 173 142 Colorimeter TCR test 172 142 3.2 Household survey Code hh_survey &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdSurvey&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-survey.rds&quot; ) ) %&gt;% dplyr::filter(survey == &quot;Household Survey&quot;) hh_survey %&gt;% group_by(country) %&gt;% summarise( Villages = n_distinct(village_id), Household = n_distinct(household_id), ILC = sum(str_detect(wp_intervention_type, &quot;ILC&quot;), na.rm = TRUE), DSW = sum(wp_intervention_type == &quot;DSW&quot;, na.rm = TRUE), `Color wheel FCR test` = sum(!is.na(discfcr)), `Color wheel TCR test` = sum(!is.na(disctcr)), `Colorimeter FCR test` = sum(!is.na(meterfcr)), `Colorimeter TCR test` = sum(!is.na(metertcr)), ) %&gt;% pivot_longer(cols = -country) %&gt;% pivot_wider( names_from = country, values_from = value ) %&gt;% kable( caption = &quot;Number of observations in household survey&quot;, col.names = c(&quot;&quot;, &quot;Malawi&quot;, &quot;Uganda&quot;), align = c(&quot;l&quot;, &quot;c&quot;, &quot;c&quot;) ) %&gt;% kable_styling( full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;) ) Table 3.3: Table 3.4: Number of observations in household survey Malawi Uganda Villages 100 60 Household 1963 1209 ILC 384 6 DSW 1278 1140 Color wheel FCR test 1897 1058 Color wheel TCR test 1896 1057 Colorimeter FCR test 854 225 Colorimeter TCR test 858 224 3.3 Monitoring survey Code mon_survey &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdSurvey&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-survey.rds&quot; ) ) %&gt;% dplyr::filter(survey == &quot;Monitoring Survey&quot;) mon_survey %&gt;% group_by(country) %&gt;% summarise( Villages = n_distinct(village_id), Household = n_distinct(household_id), ILC = sum(str_detect(wp_intervention_type, &quot;ILC&quot;), na.rm = TRUE), DSW = sum(wp_intervention_type == &quot;DSW&quot;, na.rm = TRUE), `Color wheel FCR test` = sum(!is.na(discfcr)), `Color wheel TCR test` = sum(!is.na(disctcr)), `Colorimeter FCR test` = sum(!is.na(meterfcr)), `Colorimeter TCR test` = sum(!is.na(metertcr)), ) %&gt;% pivot_longer(cols = -country) %&gt;% pivot_wider( names_from = country, values_from = value ) ## # A tibble: 8 × 3 ## name Malawi Uganda ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; ## 1 Villages 93 59 ## 2 Household 704 455 ## 3 ILC 138 1 ## 4 DSW 413 371 ## 5 Color wheel FCR test 677 396 ## 6 Color wheel TCR test 677 396 ## 7 Colorimeter FCR test 325 111 ## 8 Colorimeter TCR test 325 112 3.4 Chlorine tests Code wp %&gt;% group_by(country, intervention_type) %&gt;% summarise( `Color wheel FCR test` = sum(!is.na(discfcr)), `Color wheel TCR test` = sum(!is.na(disctcr)), `Colorimeter FCR test` = sum(!is.na(meterfcr)), `Colorimeter TCR test` = sum(!is.na(metertcr)), ) ## # A tibble: 8 × 6 ## # Groups: country [2] ## country intervention_type `Color wheel FCR test` `Color wheel TCR test` ## &lt;chr&gt; &lt;fct&gt; &lt;int&gt; &lt;int&gt; ## 1 Malawi DSW 111 111 ## 2 Malawi Non-program 1 1 ## 3 Malawi ILC water point 42 42 ## 4 Malawi ILC water collection po… 19 19 ## 5 Uganda DSW 132 132 ## 6 Uganda Non-program 8 8 ## 7 Uganda ILC water point 2 2 ## 8 Uganda ILC water collection po… 0 0 ## # ℹ 2 more variables: `Colorimeter FCR test` &lt;int&gt;, ## # `Colorimeter TCR test` &lt;int&gt; Code read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdSurvey&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-survey.rds&quot; ) ) %&gt;% group_by(country, wp_intervention_type) %&gt;% summarise( `Color wheel FCR test` = sum(!is.na(discfcr)), `Color wheel TCR test` = sum(!is.na(disctcr)), `Colorimeter FCR test` = sum(!is.na(meterfcr)), `Colorimeter TCR test` = sum(!is.na(metertcr)), ) ## # A tibble: 10 × 6 ## # Groups: country [2] ## country wp_intervention_type `Color wheel FCR test` `Color wheel TCR test` ## &lt;chr&gt; &lt;fct&gt; &lt;int&gt; &lt;int&gt; ## 1 Malawi DSW 1642 1641 ## 2 Malawi Non-program 194 194 ## 3 Malawi ILC water point 366 366 ## 4 Malawi ILC water collection p… 135 135 ## 5 Malawi &lt;NA&gt; 237 237 ## 6 Uganda DSW 1324 1323 ## 7 Uganda Non-program 88 88 ## 8 Uganda ILC water point 6 6 ## 9 Uganda ILC water collection p… 1 1 ## 10 Uganda &lt;NA&gt; 37 37 ## # ℹ 2 more variables: `Colorimeter FCR test` &lt;int&gt;, ## # `Colorimeter TCR test` &lt;int&gt; Code read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdSurvey&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-survey.rds&quot; ) ) %&gt;% group_by(country) %&gt;% summarise( `Color wheel FCR test` = sum(!is.na(discfcr)), `Color wheel TCR test` = sum(!is.na(disctcr)), `Colorimeter FCR test` = sum(!is.na(meterfcr)), `Colorimeter TCR test` = sum(!is.na(metertcr)), ) ## # A tibble: 2 × 5 ## country `Color wheel FCR test` `Color wheel TCR test` `Colorimeter FCR test` ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 Malawi 2574 2573 1179 ## 2 Uganda 1456 1455 337 ## # ℹ 1 more variable: `Colorimeter TCR test` &lt;int&gt; 3.5 Potential contamination Code hh_survey %&gt;% dplyr::filter(!is.na(int_warned)) %&gt;% tabyl(int_warned, country) %&gt;% adorn_percentages(denominator = &quot;col&quot;) %&gt;% adorn_pct_formatting() ## int_warned Malawi Uganda ## No 93.7% 75.7% ## Yes 6.3% 24.3% Code hh_survey %&gt;% dplyr::filter(int_warned == &quot;Yes&quot;) %&gt;% tabyl(int_warned_who, country) ## int_warned_who Malawi Uganda ## A neighbor 9 2 ## Other 16 20 ## Someone from outside the village 4 8 ## The promoter 8 31 Code hh_survey %&gt;% dplyr::filter(int_warned_who == &quot;Other&quot;) %&gt;% tabyl(int_warned_who_o, country) ## int_warned_who_o ## A woman ## Announcement throughout the village via megaphone ## Chairman ## Chairman LC1 ## Chairman of the village ## Chairman one for Gimbubuni Lower ## Chief ## FO ## Guider ## HSA ## Husband ## It was the LC1 Chairman who told me yesterday that you people your looking for us ## LC1 chairperson ## Nyakwawa ## Secretary LC 1 of Wanzala village ## The Chairman ## The chairperson one ## The Evidence Action personnel two men ## The LC1 Chairman on Budhebero B come and talked to us last week and even yesterday he talked to us about water treatment ## The Promoter&#39;s wife come and talked to me on Monday yesterday in the morning about water treatment before you people come The Promoter is called Katyo Peterson of Bukulabone/Ngiibo&#39;s borehole ## The village head ## The Village head ## VDC ## VHT ## Village head ## Village head also known as Anyakwawa ## Village Head also known as Anyakwawa ## Village head assistant (Nyakwawa) ## Village Healthy worker ## Visitor ## Visitors ## Malawi Uganda ## 1 0 ## 0 1 ## 1 2 ## 0 1 ## 0 2 ## 0 1 ## 2 0 ## 2 0 ## 1 0 ## 1 0 ## 0 1 ## 0 1 ## 0 1 ## 1 0 ## 0 1 ## 0 1 ## 0 1 ## 0 1 ## 0 1 ## 0 1 ## 1 0 ## 1 0 ## 1 0 ## 0 1 ## 1 0 ## 1 0 ## 1 0 ## 1 0 ## 0 1 ## 0 1 ## 0 1 Code hh_survey %&gt;% dplyr::filter(!is.na(int_warned_what)) %&gt;% mutate(int_warner = if_else(int_warned_who != &quot;Other&quot;, as.character(int_warned_who), int_warned_who_o)) %&gt;% select(country, district, village, int_warner, int_warned_what) %&gt;% arrange(country, district, village, int_warner) %&gt;% kable( caption = &quot;What was the message?&quot;, col.names = c(&quot;Country&quot;, &quot;District&quot;, &quot;Village&quot;, &quot;Who contacted&quot;, &quot;Message&quot;) ) %&gt;% kable_styling( full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;) ) Table 3.5: Table 3.6: What was the message? Country District Village Who contacted Message Malawi Balaka Phalula 1 The promoter They talked about re filling the dispenser Malawi Blantyre Rural Chinseu A neighbor There are people who are going to come and they will ask about water chlorination Malawi Blantyre Rural Chinseu Someone from outside the village The person said that she heard that in Chinseu village there are people who are coming to do water testing Malawi Blantyre Rural Chinseu The promoter Any day people will come and ask you about where you collect water and the presence of Chlorine in the dispenser Malawi Blantyre Rural Gomeza The promoter About research team which will be conducting water surveys Malawi Chiradzulu Jameskanono A neighbor Someone will come to tell you about safe water Malawi Chiradzulu Matuta 2 Chief Some workers will come in the village to teach you about clean water ,you should welcome them in your homes Malawi Chiradzulu Matuta 2 Someone from outside the village They said they are doing water research in this area Malawi Chiradzulu Mwasibu A neighbor Told the respondent that some people are testing water for chlorine Malawi Chiradzulu Mwasibu A neighbor To add a drop of chlorine from a dispenser into the water Malawi Chiradzulu Mwasibu Chairman She was told by the chairman that they should have water that have chlorine Malawi Chiradzulu Mwasibu Chief He said that people will come into houses and he told them that toilets should be clean Malawi Chiradzulu Mwasibu The promoter They need to clean there home and make water safe to drink Malawi Chiradzulu Mwasibu The promoter The promoter told her that people will come who will be focusing much on borehole and the water Malawi Chiradzulu Namveya A neighbor The respndent should apply chlorine in water Malawi Chiradzulu Namveya A neighbor Kubwela anthu muzacheze nawo zonkhudza madzi Malawi Chiradzulu Namveya FO She was told that people who do research will come and will work more on water Malawi Chiradzulu Namveya FO She was told that people will come and ask her about water Malawi Chiradzulu Namveya Guider Akuyenda aja abwela kuzayeza madzi Malawi Chiradzulu Namveya VDC They were told that people who deal with health they are coming into houses Malawi Machinga Laisi HSA To add chlorine before drinking any water Malawi Machinga Laisi Someone from outside the village Encouraged to boil water before drinking Malawi Machinga Mjoho A neighbor In few days in our village they will be new faces that they will be conducting water taste Malawi Machinga Mwangulu The promoter People will come to test the drinking if they are safe to drink Malawi Neno Chakhumbira The promoter Was told to put a drop of chlorine in a pail when one wants to draw water from the borehole and wait for 5 minutes before using the water Malawi Neno Chakhumbira Village Head also known as Anyakwawa The team is coming to test drinking water Malawi Neno Chakhumbira Village head There is a crew coming to test your drinking water Malawi Neno Chakhumbira Village head also known as Anyakwawa The team will come to test drinking water Malawi Neno Chakulembela The village head Visitors will visit water systems Malawi Neno Chakulembela Village head assistant (Nyakwawa) That we should expect visitors in our houses and welcome them as they are from government Malawi Neno Chakulembela 1 Nyakwawa To mobilise people presence in their households Malawi Neno Chakulembela 1 The Village head The people from Non government organisation will be visiting the water system Malawi Zomba Chisauta Someone from outside the village That people will come to test chlorine in households Malawi Zomba Chisauta The promoter He said people are coming to your house tonask you about water and other stuff so put chlorine in your water Malawi Zomba Mwangata 2 A neighbor Nothing just telling me someone came to share about water treatment but I wasn’t available Malawi Zomba Mwangata 2 A woman It was about chlorine and I draw water Uganda Bugiri Kibuye B Chairman LC1 The chairman told her that there will be some people who will come and talk to her about water treatment and so he told them to be polite and answer the questions that will be asked to them Uganda Bugweri Butenkaire The Chairman Some people concerned with safe water and its treatment will be visiting us soon Uganda Bugweri Butenkaire The promoter That there are some facilitators coming to teach about water Uganda Bugweri Butenkaire The promoter There will be people visiting the village concerning chlorine and drinking water Uganda Bugweri Butenkaire The promoter To clean our jerrycans used for storing drinking water Uganda Bugweri Butenkaire The promoter There will be water people who will come to teach about water treatment Uganda Bugweri Butenkaire The promoter That some facilitators concerning about water are coming Uganda Bugweri Butenkaire VHT There will be a group of people coming to teach us how to keep water safe and how to clean jerrycans used for drinking water Uganda Butaleja Nangolo Bunghaji Visitor How to make water safe Uganda Buyende Bumyuka East A neighbor That are some health workers moving around the village sensitizing people about health and sanitation in different household’ Uganda Buyende Bumyuka East Someone from outside the village There people moving in different Household’ in different Villages senstizing people about Water Treatment Uganda Buyende Bumyuka East The promoter That the Health workers will be visiting people’s households to sensitize them about water treatment and health Uganda Buyende Bumyuka East The promoter They were calling them to go to for the meeting at the Borehole to sensitise them about water treatment Uganda Buyende Bumyuka East The promoter They were taught how to use chlorine for water treatment in the meeting that took place at the Borehole Uganda Buyende Bumyuka East The promoter They were told that people would be visiting them to discuss about water treatment Uganda Buyende Butayunjwa B Chairman of the village That we shall be receiving vistors who walk about safe drinking water Uganda Buyende Butayunjwa B Someone from outside the village They should always chlorinate their drinking water but they will back for more studies Uganda Buyende Butayunjwa B Someone from outside the village Teaching them on how to turn valve Uganda Buyende Butayunjwa B The promoter They were taught how to use chlorine for water treatment Uganda Buyende Butayunjwa B The promoter They were told that visitors would be coming and were taught how to treat water Uganda Buyende Butayunjwa B The promoter They were taught how to use chlorine for water treatment Uganda Jinja Lwambogo Announcement throughout the village via megaphone We should all go to calvary Borehole and attend lessons on usage of chlorine Uganda Jinja Lwambogo The promoter Health workers will be coming to the village on issues to do with water Uganda Jinja Lwambogo The promoter There will be visitors coming to talk about chlorine Uganda Jinja Lwambogo The promoter There will be health officials coming to talk about chlorine Uganda Kaliro Bukulabone A neighbor He talked about using chlorine in drinking water Uganda Kaliro Bukulabone Chairman That whoever goes to fetch borehole should use atleast drop of chlorine in their water that has been fetched Uganda Kaliro Bukulabone Secretary LC 1 of Wanzala village There are people who will come to educate you about water treatment any day from now Uganda Kaliro Bukulabone Someone from outside the village He was asking whether the respondent uses chlorine Uganda Kaliro Bukulabone The Promoter’s wife come and talked to me on Monday yesterday in the morning about water treatment before you people come The Promoter is called Katyo Peterson of Bukulabone/Ngiibo’s borehole The Promoter’s wife was talking about water treatment and specifically treating it with chlorine And she also told me that you will be having visitors and they will be asking you about water treatment And she also ordered me to add in chlorine in the water you people will ask me for drinking before I give it to you Uganda Kaliro Bukulabone The promoter That you put 2 drops in the water when you go to fetch drinking water Uganda Kaliro Bukulabone The promoter The people concerned with borehole or chlorine they are coming, and they are moving house to housethey have some questions they are asking Uganda Kaliro Bukulabone The promoter To keep water clean by putting water guard,chlorine and boiling Uganda Kaliro Bukulabone The promoter He come on Saturday 9th/08/2025 teaching us about water treatment He also told us that there is a group of people that will be coming asking you questions to know if you apply chlorine in this water The main Promoter called kulabone Sanoni is the one who come teaching us last Saturday Uganda Luuka Kyantuma Someone from outside the village He encouraged us to use chlorine and told us that if we don’t use chlorine the borehole will be closed Uganda Luuka Kyantuma Someone from outside the village That purify your water to avoid diseases Uganda Luuka Kyantuma The promoter They taught us about water treatment ,keep the jerrycans clean and use the dispenser and only specialise one clean jerrrycan for drinking water and always apply chlorine in the drinking water Uganda Luuka Kyantuma The promoter She told them to clean their jerrycans and make sure they put chlorine in their drinking water Uganda Luuka Kyantuma The promoter She told us to clean the jerrican ,then use the dispenser to put chlorine in the water then after spend 30minutes and then start drinking Uganda Namutumba Budhebero B Bubago Husband How to use chlorine Uganda Namutumba Budhebero B Bubago It was the LC1 Chairman who told me yesterday that you people your looking for us He was telling us that you people your looking for us as we were not around Uganda Namutumba Budhebero B Bubago LC1 chairperson He told them that we’re testing water Uganda Namutumba Budhebero B Bubago Someone from outside the village How to keep water safe and use of dispenser, how many days chlorinated water should be kept Uganda Namutumba Budhebero B Bubago The LC1 Chairman on Budhebero B come and talked to us last week and even yesterday he talked to us about water treatment He told us to use chlorine and that people will be coming talking about water treatment Uganda Namutumba Budhebero B Bubago The promoter He told us to use chlorine always and that there are people who will be coming to your households testing your water if it has chlorine and he emphasised those who are not using it to use it Uganda Namutumba Budhebero B Bubago Visitors They where encouraging them to use the dispenser, Uganda Namutumba Buganda Nabisoigi Chairman People are coming to teach us how to use chlorine Uganda Namutumba Buganda Nabisoigi The Evidence Action personnel two men They told us that people will be coming this week to teach us about water treatment and they told us to be at our homes Uganda Namutumba Buganda Nabisoigi The promoter He encouraged respondent to put in chlorine the water and he distributed to her household ,after telling them there some people coming to their home Uganda Namutumba Buganda Nabisoigi The promoter That people will be coming teaching about safe drinking water in this village and that was Isa Musa Magumba the Promoter Uganda Namutumba Buganda Nabisoigi The promoter That the people of evidence action will be coming this week so wait for them Uganda Namutumba Buganda Nabisoigi The promoter We shall have visitors concerning with water treatment Uganda Sironko Gibumbuni Lower Chairman of the village Some people are coming door to door to teach you about water Uganda Sironko Gibumbuni Lower Chairman one for Gimbubuni Lower We have visitors who have come from IPA and they are here to know how we prepare water to be ready for drinking Uganda Sironko Gibumbuni Lower Someone from outside the village He said that people are coming from Kampala to know how chlorine is used This person is the one who distributes Chlorine but leaves in another village The badlock on the disperser doesn’t work so he gave a new key to my husband so that we could add chlorine in the disperser but it never opened This person came before the end of July and said we should give the visitors enough time Uganda Sironko Gibumbuni Lower The chairperson one People are coming to teach you about hygiene and water treatment Uganda Sironko Gibumbuni Lower The promoter Visitors will be coming to educate us about cleanliness so she emphasised us to be available and engage ourselves in the study Uganda Sironko Gibumbuni Lower The promoter That some visitors will come and ask me some questions Uganda Sironko Gibumbuni Lower The promoter She said that visitors have come to test how chlorine is used and they will test your water to see if it has chlorine Uganda Sironko Gibumbuni Lower Village Healthy worker To make sure that my water has chlorine in it Uganda Sironko Kyesha B The promoter -Told me that water specialists were to come pay me a visit at my home -She told me that when I have refilled the disper you should use it Code packages &lt;- c( &quot;dplyr&quot;, &quot;ggplot2&quot;, &quot;gridExtra&quot;, &quot;htmlwidgets&quot;, &quot;webshot2&quot;, &quot;mapview&quot;, &quot;magick&quot;, &quot;pagedown&quot;, &quot;readr&quot;, &quot;htmltools&quot;, &quot;leaflet&quot;, &quot;sf&quot;, &quot;randomcoloR&quot;, &quot;janitor&quot;, &quot;scales&quot;, &quot;sjmisc&quot; ) pacman::p_load(packages, character.only = TRUE) # Load data ------------------------------------------------------------------- wp_census &lt;- read_rds( file.path( path_box, &quot;Data/WaterPointCensus/DataSets/Spatial&quot;, &quot;wp-gps-constructed.rds&quot; ) ) %&gt;% mutate( icon_type = case_when( intervention_type == &quot;DSW&quot; ~ &quot;dsw&quot;, intervention_type == &quot;ILC water point&quot; ~ &quot;ilc&quot;, intervention_type == &quot;ILC water collection point&quot; ~ &quot;ilc&quot;, ), label = paste( &quot;Name:&quot;, wp_name, &quot;&lt;br&gt;&quot;, &quot;WP ID:&quot;, wp_id_c, wp_id, &quot;&lt;br&gt;&quot;, &quot;EA ID:&quot;, ea_id, &quot;&lt;br&gt;&quot;, &quot;Source type:&quot;, sourcetype, &quot;&lt;br&gt;&quot;, &quot;Functioning:&quot;, wp_func, &quot;&lt;br&gt;&quot;, &quot;Village:&quot;, village_id, &quot;&lt;br&gt;&quot;, &quot;District:&quot;, district_id ), label = lapply(label, htmltools::HTML) ) wp_census_uncollapsed &lt;- read_rds( file.path( path_box, &quot;Data/WaterPointCensus/DataSets/Spatial&quot;, &quot;wp-gps-clean.rds&quot; ) ) %&gt;% mutate( label = paste( &quot;Name:&quot;, wp_name_1, &quot;&lt;br&gt;&quot;, &quot;WP ID:&quot;, wp_id, &quot;&lt;br&gt;&quot;, &quot;Source type:&quot;, sourcetype, &quot;&lt;br&gt;&quot;, &quot;Functioning:&quot;, wp_func, &quot;&lt;br&gt;&quot;, &quot;Village:&quot;, village_id, &quot;&lt;br&gt;&quot;, &quot;District:&quot;, district_id ), label = lapply(label, htmltools::HTML) ) hh_census &lt;- read_rds( file.path( path_box, &quot;Data/HouseholdCensus/DataSets/Spatial&quot;, &quot;hh-census-constructed.rds&quot; ) ) %&gt;% mutate( label = paste( &quot;HH ID:&quot;, household_id, &quot;&lt;br&gt;&quot;, &quot;Village:&quot;, village_id, &quot;&lt;br&gt;&quot;, &quot;District:&quot;, district_id ), label = lapply(label, htmltools::HTML) ) villages &lt;- read_rds( file.path( path_box, &quot;Data/VillageBoundary&quot;, &quot;village-boundaries.rds&quot; ) ) ea_wpt &lt;- bind_rows( read_rds( file.path( path_box, &quot;Data/EvidenceAction/Spatial&quot;, &quot;ea-uganda-wp-sf.rds&quot; ) ), read_rds( file.path( path_box, &quot;Data/EvidenceAction/Spatial&quot;, &quot;ea-malawi-wp-sf.rds&quot; ) ) ) %&gt;% mutate( label = paste( &quot;EA ID:&quot;, wpt_id, &quot;&lt;br&gt;&quot;, &quot;Source type:&quot;, sourcetype, &quot;&lt;br&gt;&quot;, &quot;Intervention:&quot;, program, &quot;&lt;br&gt;&quot;, &quot;Village:&quot;, villageid, &quot;&lt;br&gt;&quot;, &quot;District:&quot;, districtid ) , label = lapply(label, htmltools::HTML) ) ea_wcp &lt;- bind_rows( read_rds( file.path( path_box, &quot;Data/EvidenceAction/Spatial&quot;, &quot;ea-uganda-wcp-sf.rds&quot; ) ), read_rds( file.path( path_box, &quot;Data/EvidenceAction/Spatial&quot;, &quot;ea-malawi-wcp-sf.rds&quot; ) ) %&gt;% mutate( across( c(wpt_villageid, wcp_villageid), ~ as.character(.) ) ) ) %&gt;% mutate( label = paste( &quot;EA ID:&quot;, wcp_id, &quot;&lt;br&gt;&quot;, &quot;Intervention: ILC water collection point&lt;br&gt;&quot;, &quot;Village:&quot;, wcp_villageid, &quot;&lt;br&gt;&quot;, &quot;District:&quot;, districtid ) , label = lapply(label, htmltools::HTML) ) # Settings -------------------------------------------------------------------- ## Icons for type of EvAc intervention ---------------------------------------- icon_list &lt;- iconList( ilc = makeIcon( iconUrl = here( path_box, &quot;Map&quot;, &quot;icons&quot;, &quot;icon_pipe.svg&quot; ), iconWidth = 8, iconHeight = 8, iconAnchorX = 4, iconAnchorY = 4 ), dsw = makeIcon( iconUrl = here( path_box, &quot;Map&quot;, &quot;icons&quot;, &quot;icon_waterdrop.svg&quot; ), iconWidth = 8, iconHeight = 8, iconAnchorX = 4, iconAnchorY = 4 ) ) ## Actual map ------------------------------------------------------------------ village_code &lt;- wp_census %&gt;% pull(village_id) leaflet() %&gt;% addTiles(options = tileOptions(opacity = 0.95)) %&gt;% addPolygons( data = villages, opacity = .8, color = &quot;orange&quot; ) %&gt;% addCircleMarkers( data = hh_census %&gt;% dplyr::filter(village_id %in% village_code), radius = 4, color = &quot;gray20&quot;, opacity = 1, fillColor = &quot;gray20&quot;, fillOpacity = 1, label = ~label ) %&gt;% # If there are no DSW water points in the village, the map will throw an error. # Comment these lines out to run itaddCircleMarkers( addCircleMarkers( data = ea_wpt %&gt;% dplyr::filter(program == &quot;DSW&quot;), radius = 11, stroke = FALSE, color = &quot;blue&quot;, fillOpacity = 1, label = ~label ) %&gt;% #If there are no ILC water points in the village, the map will throw an error. #Comment these lines out to run it addCircleMarkers( data = ea_wcp, radius = 11, stroke = FALSE, color = &quot;red&quot;, fillOpacity = 1, label = ~label ) %&gt;% addCircleMarkers( data = ea_wpt %&gt;% dplyr::filter(program == &quot;ILC&quot;), radius = 11, stroke = FALSE, color = &quot;pink&quot;, fillOpacity = 1, label = ~label ) %&gt;% addCircleMarkers( data = wp_census_uncollapsed %&gt;% dplyr::filter(village_id %in% village_code), radius = 8, stroke = FALSE, color = &quot;lightblue&quot;, fillOpacity = .5, label = ~label ) %&gt;% addCircleMarkers( data = wp_census %&gt;% dplyr::filter(village_id %in% village_code), radius = 8, stroke = FALSE, color = &quot;lightblue&quot;, fillOpacity = 1, label = ~label ) %&gt;% addMarkers( data = wp_census %&gt;% dplyr::filter(intervention_type == &quot;DSW&quot;, village_id %in% village_code), icon = icon_list$dsw ) %&gt;% addMarkers( data = wp_census %&gt;% dplyr::filter(intervention_type == &quot;ILC water point&quot;, village_id %in% village_code), icon = icon_list$ilc ) %&gt;% addMarkers( data = wp_census %&gt;% dplyr::filter(intervention_type == &quot;ILC water collection point&quot;, village_id %in% village_code), icon = icon_list$ilc ) "],["water-point-census.html", "4 Water point census 4.1 Eligible water points 4.2 Number of water points found 4.3 Type of water points 4.4 Number of water points per village 4.5 Water point functionality rate 4.6 Share of paid water points 4.7 DSW water points", " 4 Water point census Code packages &lt;- c( &quot;stringr&quot;, &quot;sf&quot;, &quot;tidyverse&quot;, &quot;viridis&quot; ) pacman::p_load( packages, character.only = TRUE ) Code wp_census &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;WaterPointCensus&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;wp-census.rds&quot; ) ) %&gt;% st_drop_geometry %&gt;% # Calculate which WPs will be included in analysis -- this is being moved to the processing code mutate(analysis = wp_multicompound &amp; wp_drink) wp_analysis &lt;- wp_census %&gt;% dplyr::filter(analysis) 4.1 Eligible water points Code eligiblity_df &lt;- wp_census %&gt;% # Calculate the relevanat statistics summarise( Visited = n_distinct(wp_id), across( c(wp_multicompound, wp_drink, wp_func, analysis), ~ sum(., na.rm = TRUE) ) ) %&gt;% # Add labels rename( Communal = wp_multicompound, `Used for drinking` = wp_drink, Functional = wp_func, `In analysis sample` = analysis ) %&gt;% # Make it one stat per line pivot_longer( cols = everything(), names_to = &quot;Name&quot;, values_to = &quot;Counts&quot; ) %&gt;% # Change the order in which the statistics will be displayed mutate( Name = factor( Name, levels = c(&quot;Visited&quot;, &quot;Communal&quot;, &quot;Used for drinking&quot;, &quot;Functional&quot;, &quot;In analysis sample&quot;), ordered = TRUE ) ) Code eligiblity_df %&gt;% ggplot( aes( x = Name, y = Counts, label = Counts ) ) + geom_col(fill = viridis(1)) + geom_text( vjust = 1.5, color = &quot;white&quot; ) + labs( title = &quot;Water Point Eligibility Criteria&quot;, x = &quot;Criteria&quot;, y = &quot;Number of water points satisfying criteria&quot;, caption = paste0( &quot;Note: Cumulative data comes from &quot;, wp_census %&gt;% pull(village_id) %&gt;% n_distinct, &quot; villages&quot; ) ) + theme 4.2 Number of water points found Code wp_analysis %&gt;% dplyr::filter(country == &quot;Malawi&quot;) %&gt;% select(wp_func, dsw, ilc_wp, ilc_wcp) %&gt;% mutate( dsw_func = case_when(dsw == 1 ~ wp_func), ilcwp_func = case_when(ilc_wp == 1 ~ wp_func), ilcwcp_func = case_when(ilc_wcp == 1 ~ wp_func), ) %&gt;% summarise( wp_n = n(), across( c( dsw_n = dsw, ilcwp_n = ilc_wp, ilcwcp_n = ilc_wcp ), ~ sum(., na.rm = TRUE) ), across( ends_with(&quot;func&quot;), ~ (mean(., na.rm = TRUE) * 100) %&gt;% round(1) ) ) %&gt;% pivot_longer( cols = everything(), names_pattern = &quot;(.*)_(.*)&quot;, names_to = c(&quot;type&quot;, &quot;.value&quot;) ) %&gt;% set_names(c(&quot; &quot;, &quot;N&quot;, &quot;Percent functioning&quot;)) %&gt;% mutate( ` ` = c(&quot;All water points&quot;, &quot;DSW&quot;, &quot;ILC water points&quot;, &quot;ILC water collection points&quot;) ) %&gt;% kable( caption = &quot;Number of water points found in Malawi&quot;, col.names = c(&quot;&quot;, &quot;N&quot;, &quot;Functional (%)&quot;), align = c(&quot;l&quot;, &quot;c&quot;, &quot;c&quot;) ) Table 4.1: Number of water points found in Malawi N Functional (%) All water points 603 90.5 DSW 197 97.5 ILC water points 133 87.2 ILC water collection points 22 77.3 Code wp_analysis %&gt;% dplyr::filter(country == &quot;Uganda&quot;) %&gt;% select(wp_func, dsw, ilc_wp, ilc_wcp) %&gt;% mutate( dsw_func = case_when(dsw == 1 ~ wp_func), ilcwp_func = case_when(ilc_wp == 1 ~ wp_func), ilcwcp_func = case_when(ilc_wcp == 1 ~ wp_func), ) %&gt;% summarise( wp_n = n(), across( c( dsw_n = dsw, ilcwp_n = ilc_wp, ilcwcp_n = ilc_wcp ), ~ sum(., na.rm = TRUE) ), across( ends_with(&quot;func&quot;), ~ (mean(., na.rm = TRUE) * 100) %&gt;% round(1) ) ) %&gt;% pivot_longer( cols = everything(), names_pattern = &quot;(.*)_(.*)&quot;, names_to = c(&quot;type&quot;, &quot;.value&quot;) ) %&gt;% set_names(c(&quot; &quot;, &quot;N&quot;, &quot;Percent functioning&quot;)) %&gt;% mutate( ` ` = c(&quot;All water points&quot;, &quot;DSW&quot;, &quot;ILC water points&quot;, &quot;ILC water collection points&quot;) ) %&gt;% kable( caption = &quot;Number of water points found in Uganda&quot;, col.names = c(&quot;&quot;, &quot;N&quot;, &quot;Functional (%)&quot;), align = c(&quot;l&quot;, &quot;c&quot;, &quot;c&quot;) ) Table 4.2: Number of water points found in Uganda N Functional (%) All water points 463 87.7 DSW 187 96.3 ILC water points 3 66.7 ILC water collection points 1 0.0 4.2.1 Averages by village Code wp_analysis %&gt;% group_by(village_id) %&gt;% summarise( total_wps = n(), dsw_wps = sum(dsw, na.rm = TRUE), ilc_device_wps = sum(ilc_wp == TRUE, na.rm = TRUE), ilc_collection_only_wps = sum(ilc_wcp == TRUE, na.rm = TRUE), has_dsw = any(dsw == TRUE, na.rm = TRUE), has_ilc = any(ilc_wcp == TRUE | ilc_wp == TRUE, na.rm = TRUE), .groups = &quot;drop&quot; ) %&gt;% #group_by(country) %&gt;% summarise( &quot;Avg. number of water points per village&quot; = mean(total_wps), &quot;Number of villages with DSW&quot; = sum(has_dsw), &quot;Avg. number of DSW water points per village (with any DSW)&quot; = dsw_wps %&gt;% if_else(has_dsw, ., NA) %&gt;% mean(na.rm = TRUE), &quot;Number of villages with ILC&quot; = sum(has_ilc), &quot;Avg. number of water points with ILC devices per village (with any ILC)&quot; = ilc_device_wps %&gt;% if_else(has_ilc, ., NA) %&gt;% mean(na.rm = TRUE), &quot;Avg. number of water points with ILC collection points per village (with any ILC)&quot; = ilc_collection_only_wps %&gt;% if_else(has_ilc, ., NA) %&gt;% mean(na.rm = TRUE) ) %&gt;% mutate( across( starts_with(&quot;Avg.&quot;), ~ round(., 1) %&gt;% as.character() ), across( starts_with(&quot;Number&quot;), ~ round(.) %&gt;% as.character() ) ) %&gt;% pivot_longer( cols = everything(), names_to = &quot;Metric&quot;, values_to = &quot;Value&quot; ) %&gt;% kable( caption = &quot;Village-level summary statistics for water points&quot;, col.names = c(&quot;Metric&quot;, &quot;Value&quot;), align = c(&quot;l&quot;, &quot;r&quot;) ) %&gt;% kable_styling( full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;) ) Table 4.3: Table 4.4: Village-level summary statistics for water points Metric Value Avg. number of water points per village 6.5 Number of villages with DSW 141 Avg. number of DSW water points per village (with any DSW) 2.7 Number of villages with ILC 38 Avg. number of water points with ILC devices per village (with any ILC) 3.6 Avg. number of water points with ILC collection points per village (with any ILC) 0.6 4.3 Type of water points 4.3.1 All water points Code wp_census %&gt;% group_by(sourcetype, intervention_type) %&gt;% summarise( n = n() ) %&gt;% group_by(sourcetype) %&gt;% mutate( total = sum(n) ) %&gt;% ggplot( aes( y = sourcetype, x = n, fill = intervention_type ) ) + geom_col() + geom_text( aes( x = total, label = total ), size = 3, hjust = 1.2, color = &quot;white&quot; ) + theme + scale_fill_viridis_d() + labs( y = NULL, x = &quot;Number of sources&quot;, fill = NULL ) 4.3.2 Program water points Code wp_census %&gt;% dplyr::filter(intervention_type != &quot;Non-program&quot;) %&gt;% group_by(sourcetype, intervention_type) %&gt;% summarise(n = n()) %&gt;% group_by(intervention_type) %&gt;% mutate( total = sum(n), pct = (n/total) * 100 ) %&gt;% ggplot( aes( y = sourcetype, x = pct, fill = intervention_type, label = pct %&gt;% round(1) ) ) + geom_col() + geom_text( aes(color = intervention_type), size = 3, hjust = 1.2 ) + facet_wrap(~ intervention_type) + theme + scale_fill_viridis_d() + scale_color_viridis_d(direction = -1) + labs( y = NULL, x = &quot;Percent of sources&quot;, fill = NULL ) 4.4 Number of water points per village Code wp_census %&gt;% group_by(village_id) %&gt;% summarise( `Water points` = n(), `DSW water points` = sum(dsw, na.rm = TRUE) %&gt;% na_if(0), `ILC water points` = sum(ilc_wp, na.rm = TRUE) %&gt;% na_if(0), `ILC water collection points` = sum(ilc_wcp, na.rm = TRUE) %&gt;% na_if(0) ) %&gt;% summarise( across( - village_id, ~ mean(., na.rm = TRUE), .names = &quot;Average_{.col}&quot; ), across( - village_id, ~ min(., na.rm = TRUE), .names = &quot;Minimum_{.col}&quot; ), across( - village_id, ~ max(., na.rm = TRUE), .names = &quot;Maximum_{.col}&quot; ) , across( - village_id, ~ sum(!is.na(.), na.rm = TRUE), .names = &quot;N_{.col}&quot; ) ) %&gt;% pivot_longer( cols = everything(), names_pattern = &quot;(.*)_(.*)&quot;, names_to = c(&quot;.value&quot;, &quot;Type&quot;) ) %&gt;% select( Type, N, Average, Minimum, Maximum ) %&gt;% rename( `Number of villages` = N ) ## # A tibble: 4 × 5 ## Type `Number of villages` Average Minimum Maximum ## &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Water points 165 7.27 1 45 ## 2 DSW water points 141 2.73 1 12 ## 3 ILC water points 31 4.39 1 27 ## 4 ILC water collection points 11 4 1 21 4.5 Water point functionality rate Overall: 86.2% DSW: 96.6% ILC water points: 86.8% ILC water collection points: 86.4% 4.6 Share of paid water points Code wp_census %&gt;% group_by(country) %&gt;% summarise(mean(wp_pay)) ## # A tibble: 2 × 2 ## country `mean(wp_pay)` ## &lt;chr&gt; &lt;dbl&gt; ## 1 Malawi NA ## 2 Uganda NA Code wp_census %&gt;% group_by(intervention_type, country) %&gt;% summarise( `Paying (%)` = (mean(wp_pay == &quot;Yes&quot;, na.rm = TRUE) * 100) %&gt;% round(1), `Payment Frequency` = wp_cost_period %&gt;% na.omit() %&gt;% {names(sort(table(.), decreasing = TRUE))[1]} ) ## # A tibble: 8 × 4 ## # Groups: intervention_type [4] ## intervention_type country `Paying (%)` `Payment Frequency` ## &lt;fct&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 DSW Malawi 70.2 Monthly ## 2 DSW Uganda 37.9 As needed/requested ## 3 Non-program Malawi 100 As needed/requested ## 4 Non-program Uganda 0 Don&#39;t know ## 5 ILC water point Malawi 71.1 As needed/requested ## 6 ILC water point Uganda 0 Don&#39;t know ## 7 ILC water collection point Malawi 56.2 Monthly ## 8 ILC water collection point Uganda NaN Don&#39;t know Code wp_census %&gt;% %&gt;% kable( caption = &quot;Water Point Payment Summary by System Type&quot;, col.names = c(&quot;Group&quot;, &quot;Country&quot;, &quot;Paying (%)&quot;, &quot;Avg. Cost (MWK)&quot;, &quot;Most Common Payment Frequency&quot;), align = &quot;lcccc&quot; ) %&gt;% kable_styling(full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;)) 4.7 DSW water points Code dsw &lt;- wp_census %&gt;% dplyr::filter(dsw == 1) 4.7.1 Functionality Code dsw %&gt;% summarise( across( c( `Water point is functional` = wp_func, `Casing is present` = disp_casing_present, `PVC pole is present` = disp_pvc_pole_present, `Tank is present` = disp_tank_present, `Valve is working (conditional on tank being present)` = jc_valve, `Dispenser is not empty (conditional on valve working)` = jc_chlorine ), ~ (mean(., na.rm = TRUE) * 100) %&gt;% round(1), .names = &quot;{.col}_Percent&quot; ), across( c( `Water point is functional` = wp_func, `Casing is present` = disp_casing_present, `PVC pole is present` = disp_pvc_pole_present, `Tank is present` = disp_tank_present, `Valve is working (conditional on tank being present)` = jc_valve, `Dispenser is not empty (conditional on valve working)` = jc_chlorine ), ~ sum(!is.na(.)), .names = &quot;{.col}_N Obs&quot; ), across( c( `Water point is functional` = wp_func, `Casing is present` = disp_casing_present, `PVC pole is present` = disp_pvc_pole_present, `Tank is present` = disp_tank_present, `Valve is working (conditional on tank being present)` = jc_valve, `Dispenser is not empty (conditional on valve working)` = jc_chlorine ), ~ sum(., na.rm = TRUE), .names = &quot;{.col}_Count&quot; ) ) %&gt;% pivot_longer( everything(), names_pattern = &quot;(.*)_(.*)&quot;, names_to = c(&quot; &quot;, &quot;.value&quot;) ) %&gt;% select(&quot; &quot;, `N Obs`, Count, Percent) ## # A tibble: 6 × 4 ## ` ` `N Obs` Count Percent ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; ## 1 Water point is functional 385 372 96.6 ## 2 Casing is present 374 373 99.7 ## 3 PVC pole is present 374 373 99.7 ## 4 Tank is present 374 360 96.3 ## 5 Valve is working (conditional on tank being present) 290 290 100 ## 6 Dispenser is not empty (conditional on valve working) 290 243 83.8 4.7.2 Chlorine dosage Code dsw %&gt;% ggplot( aes( x = jc_mldispensed, fill = as.factor(jc_mllost) ) ) + geom_vline( xintercept = 2.8, color = &quot;gray&quot;, linetype = &quot;dashed&quot; ) + geom_vline( xintercept = 3.2, color = &quot;gray&quot;, linetype = &quot;dashed&quot; ) + geom_histogram() + scale_fill_viridis_d() + theme + labs( y = &quot;Number of dispensers&quot;, x = &quot;Chlorine dose (mL)&quot;, fill = &quot;Some chlorine leaked out of the calibrated cylinder&quot; ) 4.7.3 Chlorine residual distribution Code dsw %&gt;% select( `Color wheel_TCR` = disctcr, `Color wheel_FCR` = discfcr, Colorimeter_TCR = metertcr, Colorimeter_FCR = meterfcr ) %&gt;% pivot_longer( cols = everything(), names_pattern = &quot;(.*)_(.*)&quot;, names_to = c(&quot;instrument&quot;, &quot;test&quot;) ) %&gt;% ggplot( aes( x = value, fill = instrument ) ) + scale_fill_viridis_d() + geom_density() + facet_grid(test ~ instrument) + theme + labs( x = &quot;Chlorine residual reading (mg/L)&quot;, y = &quot;Number of tests&quot; ) + theme(legend.position = &quot;none&quot;) "],["water-point-chlorine-residual-tests.html", "5 Water point chlorine residual tests 5.1 Number of observations 5.2 Color wheel and colorimeter readings 5.3 TCR and FCR readings 5.4 Dosage and chlorine residual 5.5 Wait time and chlorine residual 5.6 Reported color and chlorine residual 5.7 Water source type and chlorine residual 5.8 Source type and chlorine residual 5.9 Turbidity and chlorine residual 5.10 Colorimeter IDs and chlorine residual 5.11 Color disc IDs and chlorine residual 5.12 Enumerator IDs and chlorine residual", " 5 Water point chlorine residual tests Code library(stringr) library(sf) library(tidyverse) library(modelsummary) library(fixest) Code wp_test &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;WaterPointCensus&quot;, &quot;DataSets&quot;, &quot;Constructed&quot;, &quot;wp-chlorine.rds&quot; ) ) %&gt;% rename_with( ~ .x %&gt;% str_replace_all(&quot;meter&quot;, &quot;meter_&quot;) %&gt;% str_replace_all(&quot;disc&quot;, &quot;disc_&quot;) %&gt;% str_replace_all(&quot;cr_c$&quot;, &quot;cr&quot;) %&gt;% str_replace_all(&quot;__&quot;, &quot;_&quot;) ) %&gt;% dplyr::filter(!is.na(country), !is.na(disc_fcr)) 5.1 Number of observations Add a table showing: - Number of water points visited - Number of water points tested with color wheel - Number of water points tested with colorimeter 5.2 Color wheel and colorimeter readings Code wp_test %&gt;% select(wp_id_c, matches(&quot;(.)cr$&quot;)) %&gt;% pivot_longer( cols = -wp_id_c, names_pattern = &quot;(.*)_(.*)&quot;, names_to = c(&quot;.value&quot;, &quot;test&quot;) ) %&gt;% mutate( test = str_to_upper(test) ) %&gt;% ggplot( aes( x = meter, y = disc, color = test ) ) + geom_abline( slope = 1, color = &quot;gray80&quot; ) + geom_abline( slope = 1, intercept = 0.2, color = &quot;gray80&quot;, linetype = &quot;dashed&quot; ) + geom_abline( slope = 1, intercept = -0.2, color = &quot;gray80&quot;, linetype = &quot;dashed&quot; ) + geom_abline( slope = 1, color = &quot;gray80&quot; ) + geom_point(position = &quot;jitter&quot;) + theme + facet_wrap(~ test) + labs( x = &quot;Colorimeter reading (mg/L)&quot;, y = &quot;Color wheel reading (mg/L)&quot;, color = NULL ) + scale_color_viridis_d() 5.3 TCR and FCR readings Code wp_test %&gt;% select(wp_id_c, matches(&quot;_(.)cr$&quot;)) %&gt;% pivot_longer( cols = -wp_id_c, names_pattern = &quot;(.*)_(.*)&quot;, names_to = c(&quot;test&quot;, &quot;.value&quot;) ) %&gt;% mutate( test = case_when(test == &quot;meter&quot; ~ &quot;Colorimeter&quot;, TRUE ~ &quot;Color wheel&quot;) ) %&gt;% rename( TCR = tcr, FCR = fcr ) %&gt;% ggplot( aes( x = FCR, y = TCR, color = test ) ) + geom_abline( slope = 1, color = &quot;gray80&quot; ) + geom_abline( slope = 1, intercept = -0.1, color = &quot;gray80&quot;, linetype = &quot;dashed&quot; ) + geom_abline( slope = 1, intercept = -0.2, color = &quot;gray80&quot;, linetype = &quot;dotted&quot; ) + geom_abline( slope = 1, color = &quot;gray80&quot; ) + geom_point(position = &quot;jitter&quot;) + theme + facet_wrap(~ test) + scale_color_viridis_d() + theme(legend.position = &quot;none&quot;) 5.4 Dosage and chlorine residual Code map( c(&quot;disc_tcr&quot;, &quot;disc_fcr&quot;, &quot;meter_tcr&quot;, &quot;meter_fcr&quot;), ~ lm( paste(.x, &quot; ~ jc_mldispensed + jc_mllost&quot;) %&gt;% as.formula, data = wp_test ) ) %&gt;% set_names( c( &quot;Color wheel TCR&quot;, &quot;Color wheel FCR&quot;, &quot;Colorimeter TCR&quot;, &quot;Colorimeter FCR&quot; ) ) %&gt;% modelsummary( stars = TRUE, gof_omit = &quot;IC|Log|RMSE|R2$&quot; ) .table td.tinytable_css_34iu8w0150pas5gthvg4, .table th.tinytable_css_34iu8w0150pas5gthvg4 { text-align: center; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_bp2lebajb44yekc65jmz, .table th.tinytable_css_bp2lebajb44yekc65jmz { text-align: center; border-bottom: solid black 0.05em; } .table td.tinytable_css_4x0qa7uza8unylvsziza, .table th.tinytable_css_4x0qa7uza8unylvsziza { text-align: center; } .table td.tinytable_css_d1j4tbz599qxj4je13ae, .table th.tinytable_css_d1j4tbz599qxj4je13ae { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_4j9d5w7vu8if7am2oaei, .table th.tinytable_css_4j9d5w7vu8if7am2oaei { text-align: left; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_dm4onet61ul169zaq5l8, .table th.tinytable_css_dm4onet61ul169zaq5l8 { text-align: left; border-bottom: solid black 0.05em; } .table td.tinytable_css_0awoo6s3hgqcfg5mmtnf, .table th.tinytable_css_0awoo6s3hgqcfg5mmtnf { text-align: left; } .table td.tinytable_css_l12mxjuw560u7pstrzog, .table th.tinytable_css_l12mxjuw560u7pstrzog { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } Color wheel TCR Color wheel FCR Colorimeter TCR Colorimeter FCR + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001 (Intercept) 0.250 0.121 0.485* 0.393+ (0.229) (0.185) (0.231) (0.235) jc_mldispensed 0.265*** 0.223*** 0.240** 0.237** (0.074) (0.060) (0.075) (0.076) jc_mllostTRUE -0.169* -0.073 -0.184* -0.143+ (0.077) (0.062) (0.078) (0.079) Num.Obs. 242 242 241 242 R2 Adj. 0.078 0.063 0.072 0.056 F 11.230 9.112 10.273 8.207 5.5 Wait time and chlorine residual Code map( c( &quot;disc_tcr ~ disc_fcr_dur_wait&quot;, &quot;disc_fcr ~ disc_tcr_dur_wait&quot;, &quot;meter_tcr ~ meter_fcr_dur_wait&quot;, &quot;meter_fcr ~ meter_tcr_dur_wait&quot; ), ~ lm( as.formula(.x), data = wp_test ) ) %&gt;% set_names( c( &quot;Color wheel TCR&quot;, &quot;Color wheel FCR&quot;, &quot;Colorimeter TCR&quot;, &quot;Colorimeter FCR&quot; ) ) %&gt;% modelsummary( stars = TRUE, gof_omit = &quot;IC|Log|RMSE|R2$&quot; ) .table td.tinytable_css_4euwnd5yzeo4lntn30dl, .table th.tinytable_css_4euwnd5yzeo4lntn30dl { text-align: center; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_qdnnbmj11spj5e59647r, .table th.tinytable_css_qdnnbmj11spj5e59647r { text-align: center; border-bottom: solid black 0.05em; } .table td.tinytable_css_5ki1a4hoxuss71m4qtt6, .table th.tinytable_css_5ki1a4hoxuss71m4qtt6 { text-align: center; } .table td.tinytable_css_hgdzsw8vcboiw4pzryvi, .table th.tinytable_css_hgdzsw8vcboiw4pzryvi { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_rkdwnxhdyeqo5x1bvut4, .table th.tinytable_css_rkdwnxhdyeqo5x1bvut4 { text-align: left; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_zt4yz3lsvtvhzw7srv51, .table th.tinytable_css_zt4yz3lsvtvhzw7srv51 { text-align: left; border-bottom: solid black 0.05em; } .table td.tinytable_css_ybnuqehns93784yu02g6, .table th.tinytable_css_ybnuqehns93784yu02g6 { text-align: left; } .table td.tinytable_css_dmd4o7epxsptbah2mgdb, .table th.tinytable_css_dmd4o7epxsptbah2mgdb { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } Color wheel TCR Color wheel FCR Colorimeter TCR Colorimeter FCR + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001 (Intercept) 0.851*** 0.634*** 1.016*** 0.812*** (0.044) (0.087) (0.048) (0.070) disc_fcr_dur_wait -0.000 (0.000) disc_tcr_dur_wait 0.000 (0.000) meter_fcr_dur_wait -0.000+ (0.000) meter_tcr_dur_wait 0.000 (0.000) Num.Obs. 310 310 309 310 R2 Adj. 0.000 -0.003 0.008 0.000 F 1.016 0.003 3.355 1.067 5.6 Reported color and chlorine residual Code map( c( &quot;disc_tcr ~ disc_fcr_color&quot;, &quot;disc_fcr ~ disc_tcr_color&quot;, &quot;meter_tcr ~ meter_fcr_color&quot;, &quot;meter_fcr ~ meter_tcr_color&quot; ), ~ lm( as.formula(.x), data = wp_test ) ) %&gt;% set_names( c( &quot;Color wheel TCR&quot;, &quot;Color wheel FCR&quot;, &quot;Colorimeter TCR&quot;, &quot;Colorimeter FCR&quot; ) ) %&gt;% modelsummary( stars = TRUE, gof_omit = &quot;IC|Log|RMSE|R2$&quot; ) .table td.tinytable_css_8fmrfrt2drck0i8sken0, .table th.tinytable_css_8fmrfrt2drck0i8sken0 { text-align: center; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_ldwbw9cjkznuhjy3275c, .table th.tinytable_css_ldwbw9cjkznuhjy3275c { text-align: center; border-bottom: solid black 0.05em; } .table td.tinytable_css_96fv9vy5p5fc3akwyc6t, .table th.tinytable_css_96fv9vy5p5fc3akwyc6t { text-align: center; } .table td.tinytable_css_ph7g9cpwr9c7vvikbj2y, .table th.tinytable_css_ph7g9cpwr9c7vvikbj2y { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_iwips79g6i2dtx6diiey, .table th.tinytable_css_iwips79g6i2dtx6diiey { text-align: left; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_5qyumrah9846xlehb04e, .table th.tinytable_css_5qyumrah9846xlehb04e { text-align: left; border-bottom: solid black 0.05em; } .table td.tinytable_css_va52ltjp6jc7rihudwff, .table th.tinytable_css_va52ltjp6jc7rihudwff { text-align: left; } .table td.tinytable_css_i820esou1fuh6lpm0ako, .table th.tinytable_css_i820esou1fuh6lpm0ako { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } Color wheel TCR Color wheel FCR Colorimeter TCR Colorimeter FCR + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001 (Intercept) 0.042 0.004 0.135* 0.049 (0.060) (0.057) (0.063) (0.066) disc_fcr_color2 - Pale pink 0.553*** (0.085) disc_fcr_color3 - Pink 0.977*** (0.070) disc_fcr_color4 - Bright pink (or darker) 1.526*** (0.095) disc_tcr_color2 - Pale pink 0.286*** (0.080) disc_tcr_color3 - Pink 0.709*** (0.066) disc_tcr_color4 - Bright pink (or darker) 1.093*** (0.073) meter_fcr_color2 - Pale pink 0.238* (0.098) meter_fcr_color3 - Pink 0.876*** (0.074) meter_fcr_color4 - Bright pink (or darker) 1.371*** (0.076) meter_tcr_color2 - Pale pink 0.210+ (0.109) meter_tcr_color3 - Pink 0.711*** (0.080) meter_tcr_color4 - Bright pink (or darker) 1.278*** (0.076) Num.Obs. 310 310 309 310 R2 Adj. 0.503 0.465 0.558 0.536 F 105.205 90.526 130.371 119.958 5.7 Water source type and chlorine residual Code map( c( &quot;disc_tcr ~ disc_fcr_color&quot;, &quot;disc_fcr ~ disc_tcr_color&quot;, &quot;meter_tcr ~ meter_fcr_color&quot;, &quot;meter_fcr ~ meter_tcr_color&quot; ), ~ lm( as.formula(.x), data = wp_test ) ) %&gt;% set_names( c( &quot;Color wheel TCR&quot;, &quot;Color wheel FCR&quot;, &quot;Colorimeter TCR&quot;, &quot;Colorimeter FCR&quot; ) ) %&gt;% modelsummary( stars = TRUE, gof_omit = &quot;IC|Log|RMSE|R2$&quot; ) .table td.tinytable_css_6lh925qcxv1fc6q625o9, .table th.tinytable_css_6lh925qcxv1fc6q625o9 { text-align: center; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_ubnssl5ab0q7wayh3tlp, .table th.tinytable_css_ubnssl5ab0q7wayh3tlp { text-align: center; border-bottom: solid black 0.05em; } .table td.tinytable_css_d09vhga26w7xhftozf2q, .table th.tinytable_css_d09vhga26w7xhftozf2q { text-align: center; } .table td.tinytable_css_96umkqsdcd6td5jibfo2, .table th.tinytable_css_96umkqsdcd6td5jibfo2 { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_d6p15p4gdlzhrphevktm, .table th.tinytable_css_d6p15p4gdlzhrphevktm { text-align: left; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_jp20s945j3150fmpr3aj, .table th.tinytable_css_jp20s945j3150fmpr3aj { text-align: left; border-bottom: solid black 0.05em; } .table td.tinytable_css_5ujuhidzslvungs5iftn, .table th.tinytable_css_5ujuhidzslvungs5iftn { text-align: left; } .table td.tinytable_css_exwpjntbzrkx2vps1stx, .table th.tinytable_css_exwpjntbzrkx2vps1stx { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } Color wheel TCR Color wheel FCR Colorimeter TCR Colorimeter FCR + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001 (Intercept) 0.042 0.004 0.135* 0.049 (0.060) (0.057) (0.063) (0.066) disc_fcr_color2 - Pale pink 0.553*** (0.085) disc_fcr_color3 - Pink 0.977*** (0.070) disc_fcr_color4 - Bright pink (or darker) 1.526*** (0.095) disc_tcr_color2 - Pale pink 0.286*** (0.080) disc_tcr_color3 - Pink 0.709*** (0.066) disc_tcr_color4 - Bright pink (or darker) 1.093*** (0.073) meter_fcr_color2 - Pale pink 0.238* (0.098) meter_fcr_color3 - Pink 0.876*** (0.074) meter_fcr_color4 - Bright pink (or darker) 1.371*** (0.076) meter_tcr_color2 - Pale pink 0.210+ (0.109) meter_tcr_color3 - Pink 0.711*** (0.080) meter_tcr_color4 - Bright pink (or darker) 1.278*** (0.076) Num.Obs. 310 310 309 310 R2 Adj. 0.503 0.465 0.558 0.536 F 105.205 90.526 130.371 119.958 5.8 Source type and chlorine residual Add graph of chlorine residual distribution by type of water source 5.9 Turbidity and chlorine residual Code wp_test %&gt;% ggplot( aes( x = wp_turbidity, fill = wp_turbidity ) ) + geom_bar() + scale_fill_viridis_d() + theme + labs( y = &quot;Number of water points&quot;, x = &quot;Turbidity (1 = Clear, 5 = Very turbid)&quot; ) + theme( legend.position = &quot;none&quot; ) Code map( c( &quot;disc_diff_c ~ wp_turbidity&quot;, &quot;meter_diff_c ~ wp_turbidity&quot; ), ~ lm( as.formula(.x), data = wp_test ) ) %&gt;% set_names( c( &quot;Color wheel difference&quot;, &quot;Colorimeter difference&quot; ) ) %&gt;% modelsummary( stars = TRUE, gof_omit = &quot;IC|Log|RMSE|R2$&quot; ) .table td.tinytable_css_zj4vfbcdowmwf7ooigtg, .table th.tinytable_css_zj4vfbcdowmwf7ooigtg { text-align: center; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_zblpv8o08944hs7zm27k, .table th.tinytable_css_zblpv8o08944hs7zm27k { text-align: center; border-bottom: solid black 0.05em; } .table td.tinytable_css_zimrss2t86xwael6n041, .table th.tinytable_css_zimrss2t86xwael6n041 { text-align: center; } .table td.tinytable_css_hdaia254j14tiggt6a68, .table th.tinytable_css_hdaia254j14tiggt6a68 { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } .table td.tinytable_css_rzq0yosfo6wh64jzcs39, .table th.tinytable_css_rzq0yosfo6wh64jzcs39 { text-align: left; border-bottom: solid #d3d8dc 0.1em; } .table td.tinytable_css_12co8m76nwzdor0ux00s, .table th.tinytable_css_12co8m76nwzdor0ux00s { text-align: left; border-bottom: solid black 0.05em; } .table td.tinytable_css_79oy308d1hdknsr4pk5v, .table th.tinytable_css_79oy308d1hdknsr4pk5v { text-align: left; } .table td.tinytable_css_jp5h96v6aby0k6qotc6v, .table th.tinytable_css_jp5h96v6aby0k6qotc6v { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; } Color wheel difference Colorimeter difference + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001 (Intercept) 0.216*** 0.091*** (0.015) (0.016) wp_turbidity2 -0.103* -0.004 (0.040) (0.042) wp_turbidity3 -0.136* 0.009 (0.056) (0.058) wp_turbidity4 -0.116 -0.056 (0.170) (0.176) Num.Obs. 305 304 R2 Adj. 0.028 -0.010 F 3.888 0.046 5.10 Colorimeter IDs and chlorine residual Code wp_test %&gt;% dplyr::filter(!is.na(meter_id)) %&gt;% group_by(meter_id) %&gt;% mutate(meter_id = paste0(meter_id, &quot; (N =&quot;, n(), &quot;)&quot;)) %&gt;% ggplot( aes( y = meter_id, x = meter_fcr ) ) + geom_boxplot() + facet_grid(rows = vars(country), scales = &quot;free&quot;) + theme + labs( y = NULL, x = &quot;Free chlorine residual (mg/L)&quot; ) Code wp_test %&gt;% dplyr::filter(!is.na(meter_id)) %&gt;% group_by(meter_id) %&gt;% mutate(meter_id = paste0(meter_id, &quot; (N =&quot;, n(), &quot;)&quot;)) %&gt;% ggplot( aes( y = meter_id, x = meter_tcr ) ) + geom_boxplot() + facet_grid(rows = vars(country), scales = &quot;free&quot;) + theme + labs( y = NULL, x = &quot;Total chlorine residual (mg/L)&quot; ) 5.11 Color disc IDs and chlorine residual Code wp_test %&gt;% dplyr::filter(!is.na(meter_id)) %&gt;% group_by(disc_id) %&gt;% mutate(disc_id = paste0(meter_id, &quot; (N =&quot;, n(), &quot;)&quot;)) %&gt;% ggplot( aes( y = disc_id, x = disc_fcr ) ) + geom_boxplot() + facet_grid(rows = vars(country), scales = &quot;free&quot;) + theme + labs( y = NULL, x = &quot;Free chlorine residual (mg/L)&quot; ) Code wp_test %&gt;% dplyr::filter(!is.na(meter_id)) %&gt;% group_by(disc_id) %&gt;% mutate(disc_id = paste0(meter_id, &quot; (N =&quot;, n(), &quot;)&quot;)) %&gt;% ggplot( aes( y = disc_id, x = disc_tcr ) ) + geom_boxplot() + facet_grid(rows = vars(country), scales = &quot;free&quot;) + theme + labs( y = NULL, x = &quot;Total chlorine residual (mg/L)&quot; ) 5.12 Enumerator IDs and chlorine residual "],["household-census.html", "6 Household census 6.1 Number of observations and number/share of households using DSW and ILC water points 6.2 Number of water points per household 6.3 Reasons for using other water source 6.4 Water treatment method (HH census &amp; HH survey side by side) 6.5 Water treatment method grouped (HH census &amp; HH survey side by side) 6.6 Water treatment method by country 6.7 Households applying chlorine at home: household composition 6.8 Households applying chlorine at home: number of households in compound 6.9 Average Share of HHs using DSW, ILC, Treating, and Not Treating, by Village 6.10 Water treatment by type of water source (eg well, tap) 6.11 Share of households using at least 1 treatment method 6.12 Share of households using at least 1 treatment method by whether village has DSW or ILC 6.13 Share of households not using DSW or ILC who report DSW or ILC in village 6.14 Household composition: share of households with 1+ child under 5 or 2, pregnant woman 6.15 Household composition: average numbers of members", " 6 Household census Code packages &lt;- c( &quot;stringr&quot;, &quot;sf&quot;, &quot;tidyverse&quot;, &quot;viridis&quot;, &quot;glue&quot;, &quot;patchwork&quot;, &quot;tidyr&quot; ) pacman::p_load( packages, character.only = TRUE ) Code hh_census &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdCensus&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-census.rds&quot; ) ) %&gt;% st_drop_geometry() 6.1 Number of observations and number/share of households using DSW and ILC water points Code hh_census %&gt;% group_by(country) %&gt;% summarise( N = n(), `DSW (n)` = sum(hh_dsw, na.rm = TRUE), `DSW (%)` = round(sum(hh_dsw, na.rm = TRUE) / n() * 100, 1), `ILC (n)` = sum(hh_ilc, na.rm = TRUE), `ILC (%)` = round(sum(hh_ilc, na.rm = TRUE) / n() * 100, 1) ) %&gt;% kable( digits = 1, caption = &quot;Observations and DSW/ILC Usage by Country&quot;, format = &quot;html&quot; ) %&gt;% kable_styling( full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;) ) Table 6.1: Observations and DSW/ILC Usage by Country country N DSW (n) DSW (%) ILC (n) ILC (%) Malawi 11494 5001 43.5 1440 12.5 Uganda 9688 6065 62.6 27 0.3 6.2 Number of water points per household (Same graph in hh_survey) Code wp_distribution_census &lt;- hh_census %&gt;% mutate(wp_secweekno = if_else(is.na(wp_secweekno), 1L, wp_secweekno + 1L)) %&gt;% count(wp_secweekno) %&gt;% mutate( percentage = round(n / sum(n) * 100, 1), label = paste0(percentage, &quot;%&quot;) ) # sample total_households_census &lt;- length(unique(trimws(as.character(hh_census$household_id)))) # plot ggplot(wp_distribution_census, aes(x = as.factor(wp_secweekno), y = n, fill = as.factor(wp_secweekno))) + geom_col() + geom_text( aes(label = label), vjust = -0.5, color = &quot;black&quot; ) + scale_fill_viridis_d(option = &quot;D&quot;, direction = -1, name = &quot;Water Points Used&quot;) + labs( title = &quot;Distribution of Water Points Used in Past Month per Household&quot;, x = &quot;Number of Water Points Used&quot;, y = &quot;Number of Households&quot;, caption = paste0(&quot;Note: N= &quot;,total_households_census,&quot; households included to date in the Household Census raw data.&quot;)) + theme + theme( plot.caption = element_text(hjust = 0, face = &quot;italic&quot;), legend.position = &quot;none&quot; ) 6.3 Reasons for using other water source Code secwhen_long &lt;- hh_census %&gt;% pivot_longer( cols = c(wp_sec_notworking, wp_sec_inadequate, wp_sec_intermitent, wp_sec_notfixed, wp_sec_crowded, wp_sec_other), names_to = &quot;circumstance&quot;, values_to = &quot;used&quot; ) secwhen_used &lt;- dplyr::filter(secwhen_long, used == 1) %&gt;% dplyr::count(circumstance, sort = TRUE) %&gt;% mutate( pct = 100 * n / sum(n), circumstance_label = case_when( circumstance == &quot;wp_sec_notworking&quot; ~ &quot;Primary source is not working&quot;, circumstance == &quot;wp_sec_inadequate&quot; ~ &quot;Primary source does not give adequate water&quot;, circumstance == &quot;wp_sec_intermitent&quot; ~ &quot;Primary source gives water intermittently&quot;, circumstance == &quot;wp_sec_notfixed&quot; ~ &quot;No fixed reason&quot;, circumstance == &quot;wp_sec_crowded&quot; ~ &quot;Too many people using or waiting to use the primary water source*&quot;, circumstance == &quot;wp_sec_other&quot; ~ &quot;Other&quot;, TRUE ~ &quot;Unknown&quot; ) ) # sample hh_census_wpsec &lt;- hh_census %&gt;% mutate( has_any_wp_secwhen = !is.na(wp_sec_notworking) | !is.na(wp_sec_inadequate) | !is.na(wp_sec_intermitent) | !is.na(wp_sec_notfixed) | !is.na(wp_sec_crowded) | !is.na(wp_sec_other)) n_households &lt;- hh_census_wpsec %&gt;% summarise(n = sum(has_any_wp_secwhen)) %&gt;% pull(n) total_households_census &lt;- length(unique(hh_census$household_id)) # plot secwhen_used %&gt;% ggplot(aes(x = reorder(circumstance_label, pct), y = pct)) + geom_col(fill = viridis(1)) + coord_flip() + labs( title = &quot;Reasons for Using Other Water Points&quot;, x = &quot;Reason&quot;, y = &quot;Share of Households (%)&quot;, caption = paste0(&quot;Note: In HH census raw data, there are &quot;,total_households_census,&quot; households.\\n&quot;, &quot;Here, N=&quot;, n_households,&quot; households reporting not always using\\n&quot;, &quot;primary water point for drinking water. Each household\\n&quot;, &quot;could report more than one reason. *Added later (August).&quot;) ) + theme 6.4 Water treatment method (HH census &amp; HH survey side by side) Higher usage of chlorine from dispenser in HH survey - as expected, since those HHs use DSW/ILC dispenser. That said, among HH survey HHs, it’s just above 20% - still pretty low. In HH census, more HHs say they apply chlorine at home or boil. Code # census wtmt_cols &lt;- c( &quot;wtmt_none&quot;, &quot;wtmt_boil&quot;, &quot;wtmt_dispcl&quot;, &quot;wtmt_othercl&quot;, &quot;wtmt_strain&quot;, &quot;wtmt_filter&quot;, &quot;wtmt_sand&quot;, &quot;wtmt_solar&quot;, &quot;wtmt_decant&quot;, &quot;wtmt_pretreated&quot;, &quot;wtmt_other&quot; ) wtmt_long &lt;- hh_census %&gt;% pivot_longer( cols = all_of(wtmt_cols), names_to = &quot;method&quot;, values_to = &quot;used&quot; ) wtmt_used &lt;- dplyr::filter(wtmt_long, used == 1) %&gt;% dplyr::count(method, sort = TRUE) %&gt;% mutate( pct = 100 * n / sum(n), method_label = case_when( method == &quot;wtmt_none&quot; ~ &quot;Nothing (no treatment)&quot;, method == &quot;wtmt_boil&quot; ~ &quot;Boil&quot;, method == &quot;wtmt_dispcl&quot; ~ &quot;Apply chlorine from dispenser&quot;, method == &quot;wtmt_othercl&quot; ~ &quot;Apply chlorine at home (WaterGuard, PUR, AquaTabs)&quot;, method == &quot;wtmt_strain&quot; ~ &quot;Strain through a cloth&quot;, method == &quot;wtmt_filter&quot; ~ &quot;Use water filter&quot;, method == &quot;wtmt_sand&quot; ~ &quot;Sand/composite etc&quot;, method == &quot;wtmt_solar&quot; ~ &quot;Solar disinfection&quot;, method == &quot;wtmt_decant&quot; ~ &quot;Let it stand and settle&quot;, method == &quot;wtmt_pretreated&quot; ~ &quot;Nothing (water is already treated)*&quot;, method == &quot;wtmt_other&quot; ~ &quot;Other&quot;, TRUE ~ &quot;Unknown&quot; ) ) n_households &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0) %&gt;% nrow() # survey wtmt_cols_survey &lt;- c( &quot;make_watersafe_1&quot;, &quot;make_watersafe_2&quot;, &quot;make_watersafe_3&quot;, &quot;make_watersafe_4&quot;, &quot;make_watersafe_5&quot;, &quot;make_watersafe_6&quot;, &quot;make_watersafe_7&quot;, &quot;make_watersafe_8&quot;, &quot;make_watersafe__666&quot; ) wtmt_long_survey &lt;- hh_survey %&gt;% pivot_longer( cols = all_of(wtmt_cols_survey), names_to = &quot;method&quot;, values_to = &quot;used&quot; ) wtmt_used_survey &lt;- dplyr::filter(wtmt_long_survey, used == 1) %&gt;% dplyr::count(method, sort = TRUE) %&gt;% mutate( method_label = case_when( method == &quot;make_watersafe_1&quot; ~ &quot;Boil&quot;, method == &quot;make_watersafe_2&quot; ~ &quot;Apply chlorine from dispenser&quot;, method == &quot;make_watersafe_3&quot; ~ &quot;Apply chlorine at home (WaterGuard, PUR, AquaTabs)&quot;, method == &quot;make_watersafe_4&quot; ~ &quot;Strain through a cloth&quot;, method == &quot;make_watersafe_5&quot; ~ &quot;Use water filter&quot;, method == &quot;make_watersafe_6&quot; ~ &quot;Sand/composite etc&quot;, method == &quot;make_watersafe_7&quot; ~ &quot;Solar disinfection&quot;, method == &quot;make_watersafe_8&quot; ~ &quot;Let it stand and settle&quot;, method == &quot;make_watersafe_666&quot; ~ &quot;Other&quot;, TRUE ~ &quot;Unknown&quot; ) ) nothing_count &lt;- hh_survey %&gt;% dplyr::filter(do_anything == 0) %&gt;% nrow() wtmt_used_survey &lt;- wtmt_used_survey %&gt;% bind_rows( tibble( method = &quot;nothing&quot;, n = nothing_count, method_label = &quot;Nothing (no treatment)&quot; ) ) total_count &lt;- sum(wtmt_used_survey$n) wtmt_used_survey &lt;- wtmt_used_survey %&gt;% mutate(pct = 100 * n / total_count) # combine data from census and survey plot_data &lt;- bind_rows( wtmt_used %&gt;% mutate(dataset = &quot;HH Census&quot;) %&gt;% select(method_label, pct, dataset), wtmt_used_survey %&gt;% mutate(dataset = &quot;HH Survey&quot;) %&gt;% select(method_label, pct, dataset) ) # ensure same ordering plot_data &lt;- plot_data %&gt;% mutate(method_label = fct_reorder(method_label, pct, .fun = max)) # sample size total_households_census &lt;- length(unique(hh_census$household_id)) total_households_survey &lt;- length(unique(hh_survey$household_id)) n_households_survey &lt;- hh_survey %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols_survey)))) &gt; 0 | !is.na(do_anything)) %&gt;% nrow() n_households_census &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0) %&gt;% nrow() # plot ggplot(plot_data, aes(x = method_label, y = pct, fill = dataset)) + geom_col(show.legend = FALSE) + coord_flip() + facet_wrap(~dataset, ncol = 2) + scale_fill_viridis_d() + labs( title = &quot;Share of Households Using Each Water Treatment Method&quot;, x = &quot;Treatment Method&quot;, y = &quot;Share of Households (%)&quot;, caption = paste0( &quot;Note: For HH census, raw dataset includes &quot;,total_households_census,&quot; households. Here,\\n&quot;, &quot;N= &quot;,n_households_census,&quot; households that report not using a DSW or ILC water point.\\n&quot;, &quot;For HH survey, raw dataset includes &quot;,total_households_survey,&quot; households. Here, N=&quot;, n_households_survey, &quot;\\n&quot;, &quot;households that responded to question about treating water.\\n&quot;, &quot;Each household may report multiple methods.\\n&quot;, &quot;*Not an option in HH survey.\\n&quot; ) ) + theme 6.5 Water treatment method grouped (HH census &amp; HH survey side by side) Code # group census wtmt_used_census_cat &lt;- wtmt_long %&gt;% dplyr::filter(used == 1) %&gt;% mutate(category = case_when( method %in% c(&quot;wtmt_none&quot;, &quot;wtmt_pretreated&quot;) ~ &quot;Nothing&quot;, method %in% c(&quot;wtmt_dispcl&quot;, &quot;wtmt_othercl&quot;) ~ &quot;Chlorine&quot;, TRUE ~ &quot;Other&quot; )) %&gt;% count(category) %&gt;% mutate( pct = 100 * n / sum(n), se = 100 * sqrt((pct / 100) * (1 - pct / 100) / sum(n)), method_label = category, dataset = &quot;HH Census&quot; ) %&gt;% select(method_label, pct, se, dataset) # group survey wtmt_used_survey_cat &lt;- wtmt_long_survey %&gt;% dplyr::filter(used == 1) %&gt;% mutate(category = case_when( method %in% c(&quot;make_watersafe_2&quot;, &quot;make_watersafe_3&quot;) ~ &quot;Chlorine&quot;, method %in% c(&quot;make_watersafe_1&quot;, &quot;make_watersafe_4&quot;, &quot;make_watersafe_5&quot;, &quot;make_watersafe_6&quot;, &quot;make_watersafe_7&quot;, &quot;make_watersafe_8&quot;, &quot;make_watersafe__666&quot;) ~ &quot;Other&quot;, TRUE ~ NA_character_ )) %&gt;% count(category) # handle nothing cat wtmt_used_survey_cat &lt;- wtmt_used_survey_cat %&gt;% bind_rows(tibble(category = &quot;Nothing&quot;, n = nothing_count)) %&gt;% mutate( pct = 100 * n / sum(n), se = 100 * sqrt((pct / 100) * (1 - pct / 100) / sum(n)), method_label = category, dataset = &quot;HH Survey&quot; ) %&gt;% select(method_label, pct, se, dataset) # combine plot_data_cat &lt;- bind_rows(wtmt_used_census_cat, wtmt_used_survey_cat) %&gt;% mutate(method_label = fct_reorder(method_label, pct, .fun = max)) # plot ggplot(plot_data_cat, aes(x = method_label, y = pct, fill = dataset)) + geom_col(show.legend = FALSE, position = &quot;dodge&quot;) + geom_errorbar(aes(ymin = pct - se, ymax = pct + se), position = position_dodge(width = 0.9), width = 0.25) + geom_text( aes(label = sprintf(&quot;%.1f%%&quot;, pct)), position = position_dodge(width = 0.5), hjust = 1.1, size = 3.5, color = &quot;white&quot; ) + coord_flip() + facet_wrap(~dataset, ncol = 2) + scale_fill_viridis_d() + labs( title = &quot;Share of Households Using Each Water Treatment Method&quot;, x = &quot;Treatment Category&quot;, y = &quot;Share of Households (%)&quot;, caption = paste0( &quot;Note: For HH census, raw dataset includes &quot;, total_households_census, &quot; households. Here,\\n&quot;, &quot;N = &quot;, n_households_census, &quot; households that report not using a DSW or ILC water point.\\n&quot;, &quot;For HH survey, raw dataset includes &quot;, total_households_survey, &quot; households. Here, N = &quot;, n_households_survey, &quot;\\n&quot;, &quot;households that responded to question about treating water.\\n&quot;, &quot;Each household may report multiple methods.\\n&quot; ) ) + theme 6.6 Water treatment method by country “Apply chlorine at home” more popular in Malawi, “Boil” more popular in Uganda Code wtmt_cols &lt;- c( &quot;wtmt_none&quot;, &quot;wtmt_boil&quot;, &quot;wtmt_dispcl&quot;, &quot;wtmt_othercl&quot;, &quot;wtmt_strain&quot;, &quot;wtmt_filter&quot;, &quot;wtmt_sand&quot;, &quot;wtmt_solar&quot;, &quot;wtmt_decant&quot;, &quot;wtmt_pretreated&quot;, &quot;wtmt_other&quot; ) country_n &lt;- hh_census %&gt;% mutate(non_na_count = rowSums(!is.na(select(., all_of(wtmt_cols))))) %&gt;% group_by(country) %&gt;% summarise(n = sum(non_na_count &gt; 0), .groups = &quot;drop&quot;) wtmt_long &lt;- hh_census %&gt;% pivot_longer( cols = all_of(wtmt_cols), names_to = &quot;method&quot;, values_to = &quot;used&quot; ) wtmt_used &lt;- wtmt_long %&gt;% mutate(keep = used == 1) %&gt;% group_by(country, method) %&gt;% summarise(n = sum(keep, na.rm = TRUE), .groups = &quot;drop&quot;) %&gt;% group_by(country) %&gt;% mutate( pct = 100 * n / sum(n), method_label = case_when( method == &quot;wtmt_none&quot; ~ &quot;Nothing (no treatment)&quot;, method == &quot;wtmt_boil&quot; ~ &quot;Boil&quot;, method == &quot;wtmt_dispcl&quot; ~ &quot;Apply chlorine from dispenser&quot;, method == &quot;wtmt_othercl&quot; ~ &quot;Apply chlorine at home (WaterGuard, PUR, AquaTabs)&quot;, method == &quot;wtmt_strain&quot; ~ &quot;Strain through a cloth&quot;, method == &quot;wtmt_filter&quot; ~ &quot;Use water filter&quot;, method == &quot;wtmt_sand&quot; ~ &quot;Sand/composite etc&quot;, method == &quot;wtmt_solar&quot; ~ &quot;Solar disinfection&quot;, method == &quot;wtmt_decant&quot; ~ &quot;Let it stand and settle&quot;, method == &quot;wtmt_pretreated&quot; ~ &quot;Nothing (water is already treated)*&quot;, method == &quot;wtmt_other&quot; ~ &quot;Other&quot;, TRUE ~ &quot;Unknown&quot; ) ) %&gt;% ungroup() # sample total_households_census &lt;- length(unique(hh_census$household_id)) n_wtmt_census &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0) %&gt;% nrow() n_wtmt_uganda &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0, country == &quot;Uganda&quot;) %&gt;% nrow() n_wtmt_malawi &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0, country == &quot;Malawi&quot;) %&gt;% nrow() # plot ggplot(wtmt_used, aes(x = reorder(method_label, pct), y = pct)) + geom_col(fill = viridis(1)) + coord_flip() + facet_wrap(~ country) + labs( title = &quot;Share of Households Using Each Water Treatment Method&quot;, x = &quot;Treatment Method&quot;, y = &quot;Share of Households (%)&quot;, caption = paste0( &quot;Note: In HH census raw data, there are &quot;,total_households_census,&quot; households. Sample is\\n&quot;, &quot;households that report not using a DSW or ILC water point. Total: N = &quot;,n_wtmt_census,&quot;\\n&quot;, &quot;Sample sizes by country: Uganda: N = &quot;, n_wtmt_uganda,&quot;, Malawi: N = &quot;,n_wtmt_malawi,&quot; \\n&quot;, &quot;Each household may report multiple methods.&quot; ) ) + theme 6.7 Households applying chlorine at home: household composition When we break down by country, higher share of households with children / pregnant women among those who chlorinate LW: add standard errors Code # Uganda hh_census_uganda &lt;- hh_census %&gt;% dplyr::filter(country == &quot;Uganda&quot;) %&gt;% mutate( chlorine_home_user = wtmt_othercl == 1, responded_to_wtmt = if_any( .cols = starts_with(&quot;wtmt_method_&quot;), .fns = ~ !is.na(.x) ) ) all_households_uganda &lt;- hh_census_uganda %&gt;% summarise( group = &quot;All&quot;, N = dplyr::n(), `Child &lt;5` = mean(hh_under5 &gt;= 1, na.rm = TRUE) * 100, `Child &lt;2` = mean(hh_under2 &gt;= 1, na.rm = TRUE) * 100, `Pregnant woman` = mean(hh_pregnant &gt;= 1, na.rm = TRUE) * 100 ) responders_uganda &lt;- hh_census_uganda %&gt;% summarise( group = &quot;No DSW/ILC&quot;, N = sum(coalesce(responded_to_wtmt, FALSE)), `Child &lt;5` = mean(hh_under5[responded_to_wtmt == TRUE] &gt;= 1, na.rm = TRUE) * 100, `Child &lt;2` = mean(hh_under2[responded_to_wtmt == TRUE] &gt;= 1, na.rm = TRUE) * 100, `Pregnant woman` = mean(hh_pregnant[responded_to_wtmt == TRUE] &gt;= 1, na.rm = TRUE) * 100 ) chlorine_users_uganda &lt;- hh_census_uganda %&gt;% summarise( group = &quot;Applies Chlorine at Home&quot;, N = sum(coalesce(chlorine_home_user, FALSE)), `Child &lt;5` = mean(hh_under5[chlorine_home_user == TRUE] &gt;= 1, na.rm = TRUE) * 100, `Child &lt;2` = mean(hh_under2[chlorine_home_user == TRUE] &gt;= 1, na.rm = TRUE) * 100, `Pregnant woman` = mean(hh_pregnant[chlorine_home_user == TRUE] &gt;= 1, na.rm = TRUE) * 100 ) comp_data_uganda &lt;- bind_rows(all_households_uganda, chlorine_users_uganda, responders_uganda) %&gt;% pivot_longer( cols = c(`Child &lt;5`, `Child &lt;2`, `Pregnant woman`), names_to = &quot;Characteristic&quot;, values_to = &quot;Percent&quot; ) %&gt;% mutate(country = &quot;Uganda&quot;) # Malawi hh_census_malawi &lt;- hh_census %&gt;% dplyr::filter(country == &quot;Malawi&quot;) %&gt;% mutate( chlorine_home_user = wtmt_othercl == 1, responded_to_wtmt = if_any( .cols = starts_with(&quot;wtmt_method_&quot;), .fns = ~ !is.na(.x) ) ) all_households_malawi &lt;- hh_census_malawi %&gt;% summarise( group = &quot;All&quot;, N = dplyr::n(), `Child &lt;5` = mean(hh_under5 &gt;= 1, na.rm = TRUE) * 100, `Child &lt;2` = mean(hh_under2 &gt;= 1, na.rm = TRUE) * 100, `Pregnant woman` = mean(hh_pregnant &gt;= 1, na.rm = TRUE) * 100 ) responders_malawi &lt;- hh_census_malawi %&gt;% summarise( group = &quot;No DSW/ILC&quot;, N = sum(coalesce(responded_to_wtmt, FALSE)), `Child &lt;5` = mean(hh_under5[responded_to_wtmt == TRUE] &gt;= 1, na.rm = TRUE) * 100, `Child &lt;2` = mean(hh_under2[responded_to_wtmt == TRUE] &gt;= 1, na.rm = TRUE) * 100, `Pregnant woman` = mean(hh_pregnant[responded_to_wtmt == TRUE] &gt;= 1, na.rm = TRUE) * 100 ) chlorine_users_malawi &lt;- hh_census_malawi %&gt;% summarise( group = &quot;Applies Chlorine at Home&quot;, N = sum(coalesce(chlorine_home_user, FALSE)), `Child &lt;5` = mean(hh_under5[chlorine_home_user == TRUE] &gt;= 1, na.rm = TRUE) * 100, `Child &lt;2` = mean(hh_under2[chlorine_home_user == TRUE] &gt;= 1, na.rm = TRUE) * 100, `Pregnant woman` = mean(hh_pregnant[chlorine_home_user == TRUE] &gt;= 1, na.rm = TRUE) * 100 ) comp_data_malawi &lt;- bind_rows(all_households_malawi, chlorine_users_malawi, responders_malawi) %&gt;% pivot_longer( cols = c(`Child &lt;5`, `Child &lt;2`, `Pregnant woman`), names_to = &quot;Characteristic&quot;, values_to = &quot;Percent&quot; ) %&gt;% mutate(country = &quot;Malawi&quot;) # sample total_households_census &lt;- length(unique(hh_census$household_id)) n_wtmt_census &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0) %&gt;% nrow() n_wtmt_uganda &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0, country == &quot;Uganda&quot;) %&gt;% nrow() n_wtmt_malawi &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0, country == &quot;Malawi&quot;) %&gt;% nrow() n_othercl_uganda &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(wtmt_othercl == 1, country == &quot;Uganda&quot;) %&gt;% nrow() n_othercl_malawi &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(wtmt_othercl == 1, country == &quot;Malawi&quot;) %&gt;% nrow() # combine and plot comp_data &lt;- bind_rows(comp_data_uganda, comp_data_malawi) %&gt;% mutate( group = factor(group, levels = c( &quot;All&quot;, &quot;No DSW/ILC&quot;, &quot;Applies Chlorine at Home&quot; )) ) ggplot(comp_data, aes(x = Characteristic, y = Percent, fill = group)) + geom_col(position = position_dodge(width = 0.7), width = 0.6) + labs( title = &quot;Household Composition of Chlorine-at-Home Households vs Average&quot;, x = &quot;&quot;, y = &quot;Share of Households (%)&quot;, fill = &quot;Household Type&quot;, caption = paste0( &quot;Note: In HH census raw data, there are &quot;,total_households_census,&quot; households. Non-DSW/ILC households by country: Uganda: N = &quot;, n_wtmt_uganda,&quot;,\\n&quot;, &quot;Malawi: N = &quot;,n_wtmt_malawi,&quot;. Chlorine-at-home households by country: Uganda: N = &quot;, n_othercl_uganda,&quot;, Malawi: N = &quot;,n_othercl_malawi,&quot;.\\n&quot;, &quot;Chlorine-at-home is a subset of No DSW/ILC, which is a subset of All.&quot; ) ) + scale_fill_viridis_d(option = &quot;D&quot;, direction = -1) + facet_wrap(~ country) + theme 6.8 Households applying chlorine at home: number of households in compound Above average for households applying chlorine in Uganda, no clear pattern in Malawi Code wtmt_cols &lt;- c( &quot;wtmt_none&quot;, &quot;wtmt_boil&quot;, &quot;wtmt_dispcl&quot;, &quot;wtmt_othercl&quot;, &quot;wtmt_strain&quot;, &quot;wtmt_filter&quot;, &quot;wtmt_sand&quot;, &quot;wtmt_solar&quot;, &quot;wtmt_decant&quot;, &quot;wtmt_pretreated&quot;, &quot;wtmt_other&quot; ) # Prepare hh_census with required variables hh_census &lt;- hh_census %&gt;% mutate( chlorine_home_user = wtmt_othercl == 1, responded_to_wtmt = if_any( .cols = all_of(wtmt_cols), .fns = ~ !is.na(.x) ) ) # Function to create compound summary per country make_compound_summary &lt;- function(data, country_name) { data %&gt;% dplyr::filter(country == country_name) %&gt;% summarise( group = &quot;All&quot;, N = dplyr::n(), avg_hh_per_compound = mean(hh_hhsincompound, na.rm = TRUE) ) %&gt;% bind_rows( data %&gt;% dplyr::filter(country == country_name) %&gt;% summarise( group = &quot;No DSW/ILC&quot;, N = sum(coalesce(responded_to_wtmt, FALSE)), avg_hh_per_compound = mean(hh_hhsincompound[responded_to_wtmt == TRUE], na.rm = TRUE) ) ) %&gt;% bind_rows( data %&gt;% dplyr::filter(country == country_name) %&gt;% summarise( group = &quot;Applies Chlorine at Home&quot;, N = sum(coalesce(chlorine_home_user, FALSE)), avg_hh_per_compound = mean(hh_hhsincompound[chlorine_home_user == TRUE], na.rm = TRUE) ) ) %&gt;% mutate(country = country_name) } compound_summary_uganda &lt;- make_compound_summary(hh_census, &quot;Uganda&quot;) compound_summary_malawi &lt;- make_compound_summary(hh_census, &quot;Malawi&quot;) compound_summary &lt;- bind_rows(compound_summary_uganda, compound_summary_malawi) %&gt;% mutate( group = factor(group, levels = c( &quot;All&quot;, &quot;No DSW/ILC&quot;, &quot;Applies Chlorine at Home&quot; )), country = factor(country, levels = c(&quot;Uganda&quot;, &quot;Malawi&quot;)) ) # sample total_households_census &lt;- length(unique(hh_census$household_id)) n_wtmt_census &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0) %&gt;% nrow() n_wtmt_uganda &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0, country == &quot;Uganda&quot;) %&gt;% nrow() n_wtmt_malawi &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(rowSums(!is.na(select(., all_of(wtmt_cols)))) &gt; 0, country == &quot;Malawi&quot;) %&gt;% nrow() n_othercl_uganda &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(wtmt_othercl == 1, country == &quot;Uganda&quot;) %&gt;% nrow() n_othercl_malawi &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% dplyr::filter(wtmt_othercl == 1, country == &quot;Malawi&quot;) %&gt;% nrow() # plot ggplot(compound_summary, aes(x = group, y = avg_hh_per_compound, fill = group)) + geom_col(width = 0.6, position = position_dodge(width = 0.7)) + facet_wrap(~country) + labs( title = &quot;Avg. Number of Households per Compound by Group and Country&quot;, x = &quot;&quot;, y = &quot;Households per Compound&quot;, fill = &quot;Group&quot;, caption = paste0( &quot;Note: In HH census raw data, there are &quot;,total_households_census,&quot; households. Non-DSW/ILC households by country: Uganda: N = &quot;, n_wtmt_uganda,&quot;,\\n&quot;, &quot;Malawi: N = &quot;,n_wtmt_malawi,&quot;. Chlorine-at-home households by country: Uganda: N = &quot;, n_othercl_uganda,&quot;, Malawi: N = &quot;,n_othercl_malawi,&quot;.\\n&quot;, &quot;Chlorine-at-home is a subset of No DSW/ILC, which is a subset of All.&quot; ) ) + scale_fill_viridis_d(option = &quot;D&quot;, direction = -1) + theme 6.9 Average Share of HHs using DSW, ILC, Treating, and Not Treating, by Village LW: among everyone in village, how many people using DSW/ILC, how many not treating and aware, how many not treating and not aware Code # define treatment wtmt_used &lt;- c( &quot;wtmt_boil&quot;, &quot;wtmt_dispcl&quot;, &quot;wtmt_othercl&quot;, &quot;wtmt_strain&quot;, &quot;wtmt_filter&quot;, &quot;wtmt_sand&quot;, &quot;wtmt_solar&quot;, &quot;wtmt_decant&quot;, &quot;wtmt_other&quot; ) # classify each household hh_summary &lt;- hh_census %&gt;% rowwise() %&gt;% mutate( treat_any = any(c_across(all_of(wtmt_used)), na.rm = TRUE) ) %&gt;% ungroup %&gt;% mutate( category = case_when( str_detect(wp_intervention_type, &quot;ILC&quot;) ~ &quot;ILC&quot;, wp_intervention_type == &quot;DSW&quot; ~ &quot;DSW&quot;, treat_any ~ &quot;Neither &amp; Treat&quot;, !treat_any ~ &quot;Neither &amp; Don&#39;t Treat&quot;, TRUE ~ NA_character_ ) ) # per-village category counts (count distinct households) per_village_cat &lt;- hh_summary %&gt;% group_by(village_id, category) %&gt;% summarise(n_cat = n_distinct(household_id), .groups = &quot;drop&quot;) # total households per village (denominator) village_totals &lt;- hh_summary %&gt;% group_by(village_id) %&gt;% summarise(total_hh = n_distinct(household_id), .groups = &quot;drop&quot;) # join and compute share of village in each category per_village_cat &lt;- per_village_cat %&gt;% left_join(village_totals, by = &quot;village_id&quot;) %&gt;% mutate(share = n_cat / total_hh) per_village_wide &lt;- per_village_cat %&gt;% select(village_id, category, share) %&gt;% pivot_wider( names_from = category, values_from = share, values_fill = 0 ) avg_shares &lt;- per_village_wide %&gt;% summarise( DSW = mean(DSW, na.rm = TRUE), ILC = mean(ILC, na.rm = TRUE), `Neither &amp; Treat` = mean(`Neither &amp; Treat`, na.rm = TRUE), `Neither &amp; Don&#39;t Treat` = mean(`Neither &amp; Don&#39;t Treat`, na.rm = TRUE) ) %&gt;% pivot_longer( everything(), names_to = &quot;category&quot;, values_to = &quot;average_share&quot; ) ggplot(avg_shares, aes(x = category, y = average_share, fill = category)) + geom_col(show.legend = FALSE) + scale_y_continuous(labels = scales::percent_format(accuracy = 1)) + labs( title = &quot;Average Share of Household Treatment Categories Across Villages&quot;, x = &quot;Category&quot;, y = &quot;Average Share of Households (%)&quot; ) + scale_fill_viridis_d(option = &quot;D&quot;, direction = -1) + theme 6.10 Water treatment by type of water source (eg well, tap) LW: to do 6.11 Share of households using at least 1 treatment method Broken down by reported village access to DSW/ILC in next chart Code wtmt_used &lt;- c( &quot;wtmt_boil&quot;, &quot;wtmt_dispcl&quot;, &quot;wtmt_othercl&quot;, &quot;wtmt_strain&quot;, &quot;wtmt_filter&quot;, &quot;wtmt_sand&quot;, &quot;wtmt_solar&quot;, &quot;wtmt_decant&quot;, &quot;wtmt_other&quot; ) wtmt_include &lt;- c( &quot;wtmt_none&quot;, &quot;wtmt_pretreated&quot;, &quot;wtmt_boil&quot;, &quot;wtmt_dispcl&quot;, &quot;wtmt_othercl&quot;, &quot;wtmt_strain&quot;, &quot;wtmt_filter&quot;, &quot;wtmt_sand&quot;, &quot;wtmt_solar&quot;, &quot;wtmt_decant&quot;, &quot;wtmt_other&quot; ) hh_census &lt;- hh_census %&gt;% st_drop_geometry() hh_valid &lt;- hh_census[rowSums(!is.na(hh_census[, wtmt_include])) &gt; 0, ] summary_data &lt;- hh_valid %&gt;% st_drop_geometry() %&gt;% mutate( used_any = rowSums(select(., all_of(wtmt_used)) == 1, na.rm = TRUE) &gt; 0 ) %&gt;% count(used_any, name = &quot;n&quot;) %&gt;% mutate( pct = round(100 * n / sum(n), 1), label = ifelse(used_any, &quot;Used Treatment&quot;, &quot;Did Not Use Treatment&quot;) ) ggplot(summary_data, aes(x = &quot;&quot;, y = pct, fill = label)) + geom_col(width = 1, color = &quot;white&quot;) + coord_polar(theta = &quot;y&quot;) + geom_text(aes(label = paste0(pct, &quot;%&quot;)), position = position_stack(vjust = 0.5), color = &quot;white&quot;, size = 4) + scale_fill_viridis_d(option = &quot;D&quot;, direction = -1) + labs( title = &quot;Share of Households Using Any Water Treatment Method&quot;, caption = paste0(&quot;Note: N=&quot;, sum(summary_data$n), &quot; households that report using a non-DSW/ILC water source.&quot;) ) + theme + theme( axis.title = element_blank(), axis.text = element_blank(), axis.ticks = element_blank(), panel.grid = element_blank(), legend.title = element_blank(), plot.title = element_text(hjust = 0.5), legend.position = &quot;bottom&quot; ) 6.12 Share of households using at least 1 treatment method by whether village has DSW or ILC Note: I don’t count Nothing (already treated) as treatment Code wtmt_used &lt;- c( &quot;wtmt_boil&quot;, &quot;wtmt_dispcl&quot;, &quot;wtmt_othercl&quot;, &quot;wtmt_strain&quot;, &quot;wtmt_filter&quot;, &quot;wtmt_sand&quot;, &quot;wtmt_solar&quot;, &quot;wtmt_decant&quot;, &quot;wtmt_other&quot; ) hh_valid &lt;- as.data.frame(hh_census)[ rowSums(!is.na(hh_census[, wtmt_used])) &gt; 0, ] summary_data &lt;- hh_valid %&gt;% st_drop_geometry() %&gt;% mutate( used_any = rowSums(select(., all_of(wtmt_used)) == 1, na.rm = TRUE) &gt; 0, category = case_when( vil_dsw_selfreport == 1 &amp; vil_ilc_selfreport != 1 ~ &quot;Village: DSW Only&quot;, vil_ilc_selfreport == 1 &amp; vil_dsw_selfreport != 1 ~ &quot;Village: ILC Only&quot;, vil_dsw_selfreport == 1 &amp; vil_ilc_selfreport == 1 ~ &quot;Village: Both DSW &amp; ILC&quot;, TRUE ~ &quot;Village: Neither&quot; ) ) %&gt;% count(category, used_any, name = &quot;n&quot;) %&gt;% group_by(category) %&gt;% mutate( total_n = sum(n), pct = round(100 * n / total_n, 1), label = ifelse(used_any, &quot;Used Treatment&quot;, &quot;Did Not Use Treatment&quot;), category_label = paste0(category, &quot;\\n(n = &quot;, total_n, &quot;)&quot;) ) ggplot(summary_data, aes(x = label, y = pct, fill = label)) + geom_col(width = 0.6) + geom_text( aes( label = paste0(pct, &quot;%&quot;), vjust = ifelse(category == &quot;Village: Both DSW &amp; ILC&quot; &amp; used_any, 1.5, -0.4), color = ifelse(category == &quot;Village: Both DSW &amp; ILC&quot; &amp; used_any, &quot;white&quot;, &quot;black&quot;) ), size = 3.5, show.legend = FALSE ) + scale_color_identity() + facet_wrap(~category_label, ncol = 2) + scale_fill_viridis_d(option = &quot;D&quot;, direction = -1) + labs( title = &quot;Households Using Water Treatment by Reported DSW/ILC Availability in Village&quot;, x = NULL, y = &quot;Share of Households (%)&quot;, caption = paste0(&quot;Note: Total number of households in raw HH census data: &quot;,total_households_census,&quot;. Each panel is a distinct group of households among the &quot;, sum(summary_data$n), &quot; that report using a non-DSW/ILC water point (only these are asked about treatment in HH census).&quot;) ) + theme + theme( axis.text.x = element_text(angle = 0, hjust = 0.5), legend.position = &quot;none&quot;, strip.text = element_text(face = &quot;bold&quot;, size = 10) ) 6.13 Share of households not using DSW or ILC who report DSW or ILC in village A measure of awareness of DSW/ILC among HHs that do not use Code wtmt_summary &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% summarise( dsw_yes = sum(vil_dsw_selfreport == 1, na.rm = TRUE), dsw_total = sum(!is.na(vil_dsw_selfreport)), ilc_yes = sum(vil_ilc_selfreport == 1, na.rm = TRUE), ilc_total = sum(!is.na(vil_ilc_selfreport)) ) %&gt;% pivot_longer(cols = everything(), names_to = c(&quot;type&quot;, &quot;response&quot;), names_sep = &quot;_&quot;) %&gt;% pivot_wider(names_from = response, values_from = value) %&gt;% mutate(share = yes / total * 100) %&gt;% mutate(type = recode(type, dsw = &quot;DSW in village&quot;, ilc = &quot;ILC in village&quot;)) ggplot(wtmt_summary, aes(x = type, y = share, fill = type)) + geom_col(width = 0.6, show.legend = FALSE) + scale_fill_viridis_d(option = &quot;D&quot;, direction = -1) + labs( title = &quot;Share of HHs using non-DSW/ILC waterpoint who report a DSW or ILC waterpoint in village&quot;, x = &quot;&quot;, y = &quot;Share Self-Reporting DSW/ILC in Village (%)&quot;, caption = paste0(&quot;Note: Total number of households in raw HH census data: &quot;,total_households_census,&quot;. N=&quot;,nrow(dplyr::filter(hh_census, !is.na(vil_dsw_selfreport) | !is.na(vil_ilc_selfreport))), &quot; households that report not using a DSW or ILC water source.&quot; ) ) + theme 6.14 Household composition: share of households with 1+ child under 5 or 2, pregnant woman Code demo_vars &lt;- c(&quot;hh_pregnant&quot;, &quot;hh_under5&quot;, &quot;hh_under2&quot;) # sample total_households_census &lt;- length(unique(trimws(as.character(hh_census$household_id)))) n_demo_households &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% filter(rowSums(!is.na(select(., all_of(demo_vars)))) &gt; 0) %&gt;% nrow() hh_census %&gt;% st_drop_geometry() %&gt;% group_by(country) %&gt;% summarise( across( c(hh_under5, hh_under2, hh_pregnant), ~ mean((.) &gt;= 1, na.rm = TRUE) * 100 ) ) %&gt;% rename( `Country` = country, `Child under 5` = hh_under5, `Child under 2` = hh_under2, `Pregnant woman` = hh_pregnant ) %&gt;% kable(digits = 1, caption = paste0( &quot;Average Household Composition by Country. Note: Total number of households in raw HH census data: &quot;,total_households_census,&quot;. Averages for &quot;, n_demo_households, &quot; households included in Household Census that responded to at least 1 relevant demographic question.&quot;)) Table 6.2: Average Household Composition by Country. Note: Total number of households in raw HH census data: 21182. Averages for 21182 households included in Household Census that responded to at least 1 relevant demographic question. Country Child under 5 Child under 2 Pregnant woman Malawi 61.2 28.0 7.6 Uganda 73.9 43.4 11.5 6.15 Household composition: average numbers of members Code demo_vars &lt;- c(&quot;hh_members&quot;, &quot;hh_adults&quot;, &quot;hh_males&quot;, &quot;hh_females&quot;, &quot;hh_pregnant&quot;, &quot;hh_under5&quot;, &quot;hh_under2&quot;) # sample total_households_census &lt;- length(unique(trimws(as.character(hh_census$household_id)))) n_demo_households &lt;- hh_census %&gt;% st_drop_geometry() %&gt;% filter(rowSums(!is.na(select(., all_of(demo_vars)))) &gt; 0) %&gt;% nrow() hh_census %&gt;% st_drop_geometry() %&gt;% group_by(country) %&gt;% summarise( `Members` = mean(hh_members, na.rm = TRUE), `Adults` = mean(hh_adults, na.rm = TRUE), `Men` = mean(hh_males, na.rm = TRUE), `Women` = mean(hh_females, na.rm = TRUE), `Pregnant Women` = mean(hh_pregnant, na.rm = TRUE), `Children &lt;5` = mean(hh_under5, na.rm = TRUE), `Children &lt;2` = mean(hh_under2, na.rm = TRUE) ) %&gt;% kable( digits = 2, caption = paste0( &quot;Average Household Composition by Country. Note: Total number of households in raw HH census data: &quot;,total_households_census,&quot;. Averages for &quot;, n_demo_households, &quot; households included in Household Census that responded to at least 1 demographic question.&quot; ) ) Table 6.3: Average Household Composition by Country. Note: Total number of households in raw HH census data: 21182. Averages for 21182 households included in Household Census that responded to at least 1 demographic question. country Members Adults Men Women Pregnant Women Children &lt;5 Children &lt;2 Malawi 4.55 2.35 2.15 2.40 0.08 0.75 0.29 Uganda 5.40 2.35 2.60 2.79 0.12 1.21 0.48 "],["household-survey-1.html", "7 Household survey 7.1 Number of observations 7.2 Number of water points per household", " 7 Household survey Code library(stringr) library(sf) library(tidyverse) library(modelsummary) library(fixest) library(glue) Code hh_survey &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdSurvey&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-survey.rds&quot; ) ) %&gt;% dplyr::filter(survey == &quot;Household Survey&quot;) 7.1 Number of observations Code hh_survey %&gt;% group_by(country) %&gt;% summarise( N = n(), `Color wheel TCR &gt; 0.2` = mean(disctcr &gt; 0.2, na.rm = TRUE), `Color wheel TCR &gt; 0.2` = mean(disctcr &gt; 0.2, na.rm = TRUE), `Color wheel FCR &gt; 0.2` = mean(discfcr &gt; 0.2, na.rm = TRUE), `Color wheel FCR &gt; 0.2` = mean(discfcr &gt; 0.2, na.rm = TRUE), `Colorimeter TCR &gt; 0.2` = mean(metertcr &gt; 0.2, na.rm = TRUE), `Colorimeter TCR &gt; 0.2` = mean(metertcr &gt; 0.2, na.rm = TRUE), `Colorimeter FCR &gt; 0.2` = mean(meterfcr &gt; 0.2, na.rm = TRUE), `Colorimeter FCR &gt; 0.2` = mean(meterfcr &gt; 0.2, na.rm = TRUE) ) %&gt;% mutate( across( -c(country, N), ~ paste0(round(. * 100, 1), &quot;%&quot;) ), across(everything(), ~ as.character(.)) ) %&gt;% pivot_longer(cols = -country) ## # A tibble: 10 × 3 ## country name value ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 Malawi N 1977 ## 2 Malawi Color wheel TCR &gt; 0.2 25.3% ## 3 Malawi Color wheel FCR &gt; 0.2 17.9% ## 4 Malawi Colorimeter TCR &gt; 0.2 25.3% ## 5 Malawi Colorimeter FCR &gt; 0.2 18.5% ## 6 Uganda N 1209 ## 7 Uganda Color wheel TCR &gt; 0.2 30.2% ## 8 Uganda Color wheel FCR &gt; 0.2 19.2% ## 9 Uganda Colorimeter TCR &gt; 0.2 36.6% ## 10 Uganda Colorimeter FCR &gt; 0.2 32% 7.2 Number of water points per household LW: move this to hh survey Code wp_distribution &lt;- hh_survey %&gt;% mutate(wp_count = if_else(is.na(wp_count), 1L, wp_count + 1L)) %&gt;% count(wp_count) %&gt;% mutate(percentage = round(n / sum(n) * 100, 1), label = paste0(percentage, &quot;%&quot;) ) total_households &lt;- hh_survey %&gt;% mutate(wp_count = if_else(is.na(wp_count), 1L, wp_count + 1L)) %&gt;% count(wp_count) %&gt;% summarise(total = sum(n)) %&gt;% pull(total) ggplot(wp_distribution, aes(x = &quot;&quot;, y = n, fill = as.factor(wp_count))) + geom_col(width = 1) + coord_polar(theta = &quot;y&quot;) + geom_text( aes(label = label), position = position_stack(vjust = 0.5), color = &quot;black&quot; ) + scale_fill_viridis_d(option = &quot;D&quot;, direction = -1, name = &quot;Water Points Used&quot;) + labs( title = &quot;Distribution of Water Points Used per Household&quot;, caption = glue(&quot;Note: This data includes observations from {total_households} households included to date in the Household Survey.&quot; )) + theme( axis.title = element_blank(), axis.text = element_blank(), axis.ticks = element_blank(), panel.grid = element_blank(), plot.caption = element_text(hjust = 0, face = &quot;italic&quot;) ) "],["monitoring-survey-1.html", "8 Monitoring survey 8.1 Number of observations", " 8 Monitoring survey Code library(stringr) library(sf) library(tidyverse) library(modelsummary) library(fixest) Code hh_survey &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdSurvey&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-survey.rds&quot; ) ) %&gt;% dplyr::filter(str_detect(survey, &quot;Monitoring&quot;)) 8.1 Number of observations Code hh_survey %&gt;% group_by(country) %&gt;% summarise( N = n(), `Color wheel TCR &gt; 0.2` = mean(disctcr &gt; 0.2, na.rm = TRUE), `Color wheel FCR &gt; 0.2` = mean(discfcr &gt; 0.2, na.rm = TRUE), `Colorimeter TCR &gt; 0.2` = mean(metertcr &gt; 0.2, na.rm = TRUE), `Colorimeter FCR &gt; 0.2` = mean(meterfcr &gt; 0.2, na.rm = TRUE) ) %&gt;% mutate( across( -c(country, N), ~ paste0(round(. * 100, 1), &quot;%&quot;) ), across(everything(), ~ as.character(.)) ) %&gt;% pivot_longer(cols = -country) ## # A tibble: 10 × 3 ## country name value ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 Malawi N 704 ## 2 Malawi Color wheel TCR &gt; 0.2 24.7% ## 3 Malawi Color wheel FCR &gt; 0.2 20.4% ## 4 Malawi Colorimeter TCR &gt; 0.2 26.2% ## 5 Malawi Colorimeter FCR &gt; 0.2 20.3% ## 6 Uganda N 455 ## 7 Uganda Color wheel TCR &gt; 0.2 43.2% ## 8 Uganda Color wheel FCR &gt; 0.2 30.6% ## 9 Uganda Colorimeter TCR &gt; 0.2 36.6% ## 10 Uganda Colorimeter FCR &gt; 0.2 32.4% "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
