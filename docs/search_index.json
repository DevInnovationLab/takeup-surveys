[["index.html", "Estimating Chlorination Take-up in Malawi and Uganda 1 Introduction", " Estimating Chlorination Take-up in Malawi and Uganda 2025-10-10 1 Introduction This notebook presents the code used for analaysis in the report to GiveWell. To see the code used to create each exhibit, click on the Code button. "],["primary-outcomes.html", "2 Primary outcomes 2.1 People using DSW/ILC water points 2.2 Chlorine detection rates", " 2 Primary outcomes Code pacman::p_load( sf, tidyverse, viridis, fixest, janitor, broom, car, modelsummary, survey ) 2.1 People using DSW/ILC water points To calculate the number of people using water points with DSW or ILC, we use self-reported data from the household census on what is the household’s primary water point. This information is combined with data from the water point census to determine whether these water points are served by DSW or ILC. We start by restricting the household census data to households using water points with DSW or ILC located inside the sampled villages. Code hh_census &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdCensus&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-census.rds&quot; ) ) %&gt;% st_drop_geometry() %&gt;% dplyr::filter( wp_intervention_type != &quot;Non-program&quot;, wp_invillage ) The relevant variable to calculate the number of people using water points with DSW or ILC is the number of people living in households that report their primary water source has DSW or ILC. Due to a coding mistake, this variable was not collected in the first few days of data collection in Uganda. Therefore, we need to impute values for the households where this information is missing. Code hh_census %&gt;% dplyr::filter(!is.na(wp_intervention_type), is.na(hh_members)) %&gt;% tabyl(date, country) %&gt;% adorn_totals() ## date Uganda ## 2025-07-02 4 ## 2025-07-03 35 ## 2025-07-04 3 ## 2025-07-07 13 ## 2025-07-08 256 ## 2025-07-09 158 ## 2025-07-10 28 ## 2025-07-11 37 ## 2025-07-14 130 ## 2025-07-15 22 ## 2025-07-16 1 ## Total 687 In Malawi, there are only two households that weren’t asked this question, so we can impute it at with the village average. In Uganda, there are 8 villages with no observations for this variable, so we cannot impute it as the village average. Therefore, we impute it are the sample group level. Code hh_census_imputed &lt;- hh_census %&gt;% # Impute at village-level if possible group_by(village_id) %&gt;% mutate( hh_members = if_else( !is.na(hh_members), hh_members, mean(hh_members, na.rm = TRUE) ) ) %&gt;% # If still missing, impute at the sample group level group_by(country, sample_group) %&gt;% mutate( hh_members = if_else( !is.na(hh_members), hh_members, mean(hh_members, na.rm = TRUE) ) ) Since the unit of reference for our analysis is the village, we calculate the number of households whose primary water source has DSW or ILC by adding the number of household members across all such households in a village. Code users_village &lt;- hh_census_imputed %&gt;% group_by(village_id, country, sample_group) %&gt;% summarise( hhs = n(), users = sum(hh_members) ) %&gt;% left_join(weights) %&gt;% dplyr::filter(n() &gt; 1) %&gt;% group_by(country, sample_group) %&gt;% mutate( weight = pop/n() ) %&gt;% ungroup ## `summarise()` has grouped output by &#39;village_id&#39;, &#39;country&#39;. You can override using the `.groups` argument. ## Joining with `by = join_by(country, sample_group)` Code users_village &lt;- hh_census_imputed %&gt;% group_by(village_id, country, sample_group) %&gt;% summarise( hhs = n(), users = sum(hh_members) ) %&gt;% left_join(weights) %&gt;% group_by(country, sample_group) %&gt;% dplyr::filter(n() &gt; 1) %&gt;% mutate( weight = pop/n() ) %&gt;% ungroup ## `summarise()` has grouped output by &#39;village_id&#39;, &#39;country&#39;. You can override using the `.groups` argument. ## Joining with `by = join_by(country, sample_group)` Code users_village %&gt;% group_by(country, sample_group) %&gt;% summarise( hhs = mean(hhs), people = mean(users) ) ## `summarise()` has grouped output by &#39;country&#39;. You can override using the ## `.groups` argument. ## # A tibble: 5 × 4 ## # Groups: country [2] ## country sample_group hhs people ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Malawi Expansion 77.8 369. ## 2 Malawi Footprint 48.2 212. ## 3 Malawi ILC 69.3 301. ## 4 Uganda Expansion 116. 623. ## 5 Uganda Footprint 51.7 278. We then calculate the total number of users per sample group and the confidence intervals around this number. We use the package survey to account for the survey design when calculating standard errors and to weigh each sample group according to the number of villages in this group across the entire country. Code group_total &lt;- map( users_village %&gt;% group_by(country, sample_group) %&gt;% group_split(), ~ total_cis(data = ., var = &quot;users&quot;) ) %&gt;% bind_rows() %&gt;% bind_cols( users_village %&gt;% select(country, sample_group) %&gt;% arrange(country, sample_group) %&gt;% unique ) country_total &lt;- map( users_village %&gt;% group_by(country) %&gt;% group_split(), ~ total_cis(data = ., var = &quot;users&quot;) ) %&gt;% bind_rows() %&gt;% bind_cols( users_village %&gt;% select(country) %&gt;% arrange(country) %&gt;% unique ) %&gt;% mutate(sample_group = &quot;Total&quot;) Code group_total %&gt;% bind_rows(country_total) %&gt;% mutate( across( c(total, lb, ub), ~ round(.) %&gt;% format(big.mark = &quot;,&quot;) ), ci = paste0(&quot;(&quot;, lb,&quot;, &quot;, ub, &quot;)&quot;), sample_group = sample_group %&gt;% factor( levels = c(&quot;Footprint&quot;, &quot;Expansion&quot;, &quot;ILC&quot;, &quot;Total&quot;), ordered = TRUE ) ) %&gt;% arrange(country, sample_group) %&gt;% select( sample_group, total, ci ) %&gt;% kable( col.names = c( &quot;Village group&quot;, &quot;Country estimate&quot;, &quot;95% CI&quot; ), format = &quot;html&quot;, align = &quot;c&quot; ) %&gt;% pack_rows(&quot;Malawi&quot;, 1, 4) %&gt;% pack_rows(&quot;Uganda&quot;, 5, 7) %&gt;% kable_paper(&quot;striped&quot;, full_width = F) Village group Country estimate 95% CI Malawi Footprint 246,043 ( 178,122, 313,963) Expansion 1,775,112 (1,174,235, 2,375,990) ILC 190,239 ( 141,763, 238,715) Total 2,211,394 (1,604,750, 2,818,038) Uganda Footprint 880,206 ( 655,976, 1,104,435) Expansion 2,497,691 (1,859,914, 3,135,469) Total 3,377,897 (2,701,850, 4,053,944) 2.2 Chlorine detection rates Code hh_survey &lt;- read_rds( file.path( path_box, &quot;Data&quot;, &quot;HouseholdSurvey&quot;, &quot;DataSets&quot;, &quot;Final&quot;, &quot;hh-survey.rds&quot; ) ) %&gt;% dplyr::filter( survey == &quot;Household Survey&quot; ) %&gt;% group_by(village_id) %&gt;% dplyr::filter(n() &gt; 1) %&gt;% ungroup Code hh_survey_grouped &lt;- hh_survey %&gt;% dplyr::filter( wp_intervention_type != &quot;Non-program&quot;, !(wp_intervention_type == &quot;DSW&quot; &amp; sample_group == &quot;ILC&quot;), !(str_detect(wp_intervention_type, &quot;ILC&quot;) &amp; sample_group == &quot;DSW&quot;) ) %&gt;% group_by(village_id) %&gt;% dplyr::filter(n() &gt; 1) %&gt;% group_by(country, sample_group) %&gt;% group_split treatment &lt;- hh_survey_grouped %&gt;% map( ~ village_mean_ci( data = .x, outcomes = c(&quot;make_watersafe_2&quot;, test_vars), dummy = TRUE ) %&gt;% mutate( country = .x %&gt;% pull(country) %&gt;% unique, sample_group = .x %&gt;% pull(sample_group) %&gt;% unique ) ) %&gt;% bind_rows %&gt;% mutate( outcome = outcome %&gt;% factor( levels = c( &quot;make_watersafe_2&quot;, &quot;disctcr_02&quot;, &quot;metertcr_02&quot;, &quot;metertcr_01&quot;, &quot;discfcr_02&quot;, &quot;meterfcr_02&quot;, &quot;meterfcr_01&quot; ), ordered = TRUE ) ) treatment %&gt;% mutate( mean = round(mean * 100, 1) %&gt;% as.character, ci = paste0(&quot;(&quot;, round(lb * 100, 1),&quot;, &quot;, round(ub * 100, 1), &quot;)&quot;) ) %&gt;% pivot_longer( cols = c(mean, ci) ) %&gt;% select(country, outcome, sample_group, name, value) %&gt;% pivot_wider( values_from = value, names_from = outcome ) %&gt;% mutate(sample_group = if_else(name == &quot;ci&quot;, &quot;&quot;, sample_group)) %&gt;% select( sample_group, make_watersafe_2, disctcr_02, discfcr_02, metertcr_02, meterfcr_02, metertcr_01, meterfcr_01 ) %&gt;% kable( col.names = c( &quot;Village group&quot;, &quot;Self-report&quot;, &quot;TCR &gt;= 0.2 ppm&quot;, &quot;FCR &gt;= 0.2 ppm&quot;, &quot;TCR &gt;= 0.2 ppm&quot;, &quot;FCR &gt;= 0.2 ppm&quot;, &quot;TCR &gt;= 0.1 ppm&quot;, &quot;FCR &gt;= 0.1 ppm&quot; ), format = &quot;html&quot;, align = &quot;c&quot; ) %&gt;% pack_rows(&quot;Malawi&quot;, 1, 6) %&gt;% pack_rows(&quot;Uganda&quot;, 7, 10) %&gt;% add_header_above(c(&quot; &quot; = 2, &quot;Color disc&quot; = 2, &quot;Colorimeter&quot; = 4)) %&gt;% kable_paper(&quot;striped&quot;, full_width = F) %&gt;% footnote(general = &quot;Sample considers only households using water points with DSW as their primary water points in Expansion and Footprint villages, and only households using water points with ILC as their primary water points in ILC villages.&quot;) Color disc Colorimeter Village group Self-report TCR &gt;= 0.2 ppm FCR &gt;= 0.2 ppm TCR &gt;= 0.2 ppm FCR &gt;= 0.2 ppm TCR &gt;= 0.1 ppm FCR &gt;= 0.1 ppm Malawi Expansion 26.6 27.2 22 26.1 18.5 37.6 23.9 (23.6, 29.6) (24, 30.5) (19, 25) (20.6, 31.6) (13.7, 23.3) (31.5, 43.7) (18.6, 29.2) Footprint 27.5 30.2 21.8 23.1 19.7 39.7 26.3 (23.6, 31.4) (26.4, 34.1) (18.1, 25.5) (17.4, 28.9) (14.3, 25.1) (33.1, 46.3) (20.3, 32.2) ILC 1.4 26.8 12.4 17.9 10.6 32.7 18 (0.2, 2.6) (22.6, 30.9) (9.2, 15.6) (12.5, 23.3) (6.1, 15) (25.8, 39.6) (12.5, 23.5) Uganda Expansion 33.7 32.7 21.2 38.3 33.3 44.3 39.5 (29.9, 37.6) (28.9, 36.6) (17.8, 24.5) (30.7, 45.8) (26.3, 40.3) (36.3, 52.3) (31.7, 47.2) Footprint 28.3 28.7 18.6 35 29.8 45.6 39.4 (24.7, 31.8) (25.1, 32.3) (15.4, 21.7) (26.5, 43.4) (21.2, 38.4) (36.5, 54.8) (30.3, 48.6) Note: Sample considers only households using water points with DSW as their primary water points in Expansion and Footprint villages, and only households using water points with ILC as their primary water points in ILC villages. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
